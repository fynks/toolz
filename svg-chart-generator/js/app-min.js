let data=[],darkMode=!1,chartGenerated=!1;function showMessage(t,e=!1,n="success"){const a=document.getElementById("message"),r=document.getElementById("messageText"),s=a.querySelector("i");r.textContent=t,a.className="",e||"error"===n?(a.classList.add("toast-error"),s.className="fas fa-exclamation-circle"):"warning"===n?(a.classList.add("toast-warning"),s.className="fas fa-exclamation-triangle"):"info"===n?(a.classList.add("toast-info"),s.className="fas fa-info-circle"):(a.classList.add("toast-success"),s.className="fas fa-check-circle"),a.classList.add("show"),setTimeout((()=>{a.classList.remove("show")}),3e3)}function updateUI(){const t=document.getElementById("entriesSection"),e=document.getElementById("exportOptions"),n=document.getElementById("emptyState"),a=document.getElementById("chart");data.length>0?t.style.display="block":t.style.display="none",chartGenerated&&data.length>0?(e.style.display="flex",n.style.display="none",a.style.display="block"):(e.style.display="none",n.style.display="flex",a.style.display="none"),document.getElementById("entryCount").textContent=data.length}function addEntry(){const t=document.getElementById("entries"),e=data.length,n={label:`Item ${e+1}`,value:Math.floor(100*Math.random())+1,color:getRandomColor()};data.push(n);const a=document.createElement("div");a.className="entry-item fade-in",a.innerHTML=`\n                <input type="text" \n                       class="form-input" \n                       placeholder="Enter label" \n                       value="${n.label}" \n                       onchange="updateData(${e}, 'label', this.value)"\n                       oninput="validateInput(this)">\n                <input type="number" \n                       class="form-input" \n                       placeholder="Enter value" \n                       value="${n.value}" \n                       min="0"\n                       step="0.1"\n                       onchange="updateData(${e}, 'value', this.value)"\n                       oninput="validateInput(this)">\n                <div class="color-input-wrapper">\n                    <input type="color" \n                           class="color-input" \n                           value="${n.color}" \n                           onchange="updateData(${e}, 'color', this.value)"\n                           title="Choose color">\n                </div>\n                <button class="btn btn-danger" \n                        onclick="removeEntry(${e})" \n                        title="Remove entry"\n                        aria-label="Remove entry">\n                    <i class="fas fa-times"></i>\n                </button>\n            `,t.appendChild(a),updateUI(),chartGenerated&&generateChart()}function removeEntry(t){data.length<=1?showMessage("Cannot remove the last entry. Add more entries first.",!0,"error"):t>=0&&t<data.length&&(data.splice(t,1),refreshEntries(),updateUI(),chartGenerated&&generateChart())}function refreshEntries(){const t=document.getElementById("entries");t.innerHTML="",data.forEach(((e,n)=>{const a=document.createElement("div");a.className="entry-item slide-in",a.innerHTML=`\n                    <input type="text" \n                           class="form-input" \n                           placeholder="Enter label" \n                           value="${e.label}" \n                           onchange="updateData(${n}, 'label', this.value)"\n                           oninput="validateInput(this)">\n                    <input type="number" \n                           class="form-input" \n                           placeholder="Enter value" \n                           value="${e.value}" \n                           min="0"\n                           step="0.1"\n                           onchange="updateData(${n}, 'value', this.value)"\n                           oninput="validateInput(this)">\n                    <div class="color-input-wrapper">\n                        <input type="color" \n                               class="color-input" \n                               value="${e.color}" \n                               onchange="updateData(${n}, 'color', this.value)"\n                               title="Choose color">\n                    </div>\n                    <button class="btn btn-danger" \n                            onclick="removeEntry(${n})" \n                            title="Remove entry"\n                            aria-label="Remove entry">\n                        <i class="fas fa-times"></i>\n                    </button>\n                `,t.appendChild(a)}))}function validateInput(t){const e=t.value.trim();return"number"===t.type&&(isNaN(e)||e<0)?(t.style.borderColor="var(--danger-color)",!1):"text"===t.type&&""===e?(t.style.borderColor="var(--warning-color)",!1):(t.style.borderColor="var(--border-color)",!0)}function getRandomColor(){const t=["#4f46e5","#7c3aed","#dc2626","#ea580c","#d97706","#ca8a04","#65a30d","#16a34a","#059669","#0891b2","#0284c7","#2563eb","#4338ca","#7c2d12","#a21caf"];return t[Math.floor(Math.random()*t.length)]}function updateData(t,e,n){if(!(t>=data.length)){if("value"===e){const a=parseFloat(n);if(isNaN(a)||a<0)return void showMessage("Please enter a valid positive number",!0,"error");data[t][e]=a}else data[t][e]=n;updateUI(),chartGenerated&&generateChart()}}function generateChart(){if(0===data.length)return void addSampleData();const t=document.getElementById("chart"),e=document.getElementById("xLabel").value.trim()||"Categories",n=document.getElementById("yLabel").value.trim()||"Values",a=document.getElementById("chartType").value,r=data.filter((t=>""!==t.label.trim()&&!isNaN(t.value)&&t.value>=0));if(0===r.length)return void showMessage("Please add valid data entries with labels and positive values",!0,"error");t.innerHTML="";const s=900,o=500;t.setAttribute("viewBox","0 0 900 500"),t.setAttribute("preserveAspectRatio","xMidYMid meet");const i={top:50,right:50,bottom:120,left:80},l=s-i.left-i.right,d=o-i.top-i.bottom,c=Math.max(...r.map((t=>t.value)),1),u=document.body.classList.contains("dark-theme")?"#ffffff":"#000000",h=document.body.classList.contains("dark-theme")?"#4b5563":"#e5e7eb",m=document.createElementNS("http://www.w3.org/2000/svg","rect");m.setAttribute("width",s),m.setAttribute("height",o),m.setAttribute("fill",document.body.classList.contains("dark-theme")?"#1f2937":"#ffffff"),t.appendChild(m),addGridLines(t,i,l,d,s,o,c,h),addAxes(t,i,l,d,s,o,u),"bar"===a?generateBarChart(t,r,i,l,d,c,u):"line"===a?generateLineChart(t,r,i,l,d,c,u):"pie"===a&&generatePieChart(t,r,s,o,u),"pie"!==a&&addAxisLabels(t,e,n,s,o,i,u),chartGenerated=!0,updateUI(),showMessage("Chart generated successfully!",!1,"success")}function addSampleData(){data=[{label:"Product A",value:45,color:"#4f46e5"},{label:"Product B",value:30,color:"#7c3aed"},{label:"Product C",value:25,color:"#dc2626"},{label:"Product D",value:60,color:"#16a34a"}],refreshEntries(),updateUI(),generateChart()}function addGridLines(t,e,n,a,r,s,o,i){const l=document.createElementNS("http://www.w3.org/2000/svg","g");l.setAttribute("class","grid");for(let t=0;t<=5;t++){const n=e.top+a/5*t,s=document.createElementNS("http://www.w3.org/2000/svg","line");s.setAttribute("x1",e.left),s.setAttribute("y1",n),s.setAttribute("x2",r-e.right),s.setAttribute("y2",n),s.setAttribute("stroke",i),s.setAttribute("stroke-width","1"),s.setAttribute("opacity","0.5"),l.appendChild(s);const d=o-o/5*t,c=document.createElementNS("http://www.w3.org/2000/svg","text");c.setAttribute("x",e.left-10),c.setAttribute("y",n+5),c.setAttribute("text-anchor","end"),c.setAttribute("font-size","12"),c.setAttribute("fill",i),c.textContent=Math.round(10*d)/10,l.appendChild(c)}t.appendChild(l)}function addAxes(t,e,n,a,r,s,o){const i=document.createElementNS("http://www.w3.org/2000/svg","line");i.setAttribute("x1",e.left),i.setAttribute("y1",s-e.bottom),i.setAttribute("x2",r-e.right),i.setAttribute("y2",s-e.bottom),i.setAttribute("stroke",o),i.setAttribute("stroke-width","2"),t.appendChild(i);const l=document.createElementNS("http://www.w3.org/2000/svg","line");l.setAttribute("x1",e.left),l.setAttribute("y1",e.top),l.setAttribute("x2",e.left),l.setAttribute("y2",s-e.bottom),l.setAttribute("stroke",o),l.setAttribute("stroke-width","2"),t.appendChild(l)}function generateBarChart(t,e,n,a,r,s,o){const i=a/e.length*.8,l=a/e.length*.2,d=document.createElementNS("http://www.w3.org/2000/svg","g");d.setAttribute("class","bars"),e.forEach(((t,e)=>{const a=Math.max(t.value/s*r,2),c=n.left+e*(i+l)+l/2,u=n.top+r-a,h=document.createElementNS("http://www.w3.org/2000/svg","rect");h.setAttribute("x",c),h.setAttribute("y",u),h.setAttribute("width",i),h.setAttribute("height",a),h.setAttribute("fill",t.color),h.setAttribute("rx","4"),h.setAttribute("class","chart-bar"),h.addEventListener("mouseenter",(function(){this.style.opacity="0.8",this.style.transform="translateY(-2px)"})),h.addEventListener("mouseleave",(function(){this.style.opacity="1",this.style.transform="translateY(0)"})),d.appendChild(h);const m=document.createElementNS("http://www.w3.org/2000/svg","text");m.setAttribute("x",c+i/2),m.setAttribute("y",u-8),m.setAttribute("text-anchor","middle"),m.setAttribute("font-size","12"),m.setAttribute("font-weight","600"),m.setAttribute("fill",o),m.textContent=t.value,d.appendChild(m);const b=document.createElementNS("http://www.w3.org/2000/svg","text");b.setAttribute("x",c+i/2),b.setAttribute("y",n.top+r+20),b.setAttribute("text-anchor","middle"),b.setAttribute("font-size","12"),b.setAttribute("fill",o),b.textContent=t.label.length>10?t.label.substring(0,10)+"...":t.label,d.appendChild(b)})),t.appendChild(d)}function generateLineChart(t,e,n,a,r,s,o){if(e.length<2)return void showMessage("Line chart requires at least 2 data points",!0,"warning");const i=document.createElementNS("http://www.w3.org/2000/svg","g");i.setAttribute("class","line-chart");const l=e.map(((t,o)=>`${n.left+o*a/(e.length-1)},${n.top+r-t.value/s*r}`)).join(" "),d=document.createElementNS("http://www.w3.org/2000/svg","polyline");d.setAttribute("points",l),d.setAttribute("fill","none"),d.setAttribute("stroke","#4f46e5"),d.setAttribute("stroke-width","3"),d.setAttribute("stroke-linecap","round"),d.setAttribute("stroke-linejoin","round"),i.appendChild(d),e.forEach(((t,l)=>{const d=n.left+l*a/(e.length-1),c=n.top+r-t.value/s*r,u=document.createElementNS("http://www.w3.org/2000/svg","circle");u.setAttribute("cx",d),u.setAttribute("cy",c),u.setAttribute("r","6"),u.setAttribute("fill",t.color),u.setAttribute("stroke","#ffffff"),u.setAttribute("stroke-width","2"),u.addEventListener("mouseenter",(function(){this.setAttribute("r","8")})),u.addEventListener("mouseleave",(function(){this.setAttribute("r","6")})),i.appendChild(u);const h=document.createElementNS("http://www.w3.org/2000/svg","text");h.setAttribute("x",d),h.setAttribute("y",n.top+r+20),h.setAttribute("text-anchor","middle"),h.setAttribute("font-size","12"),h.setAttribute("fill",o),h.textContent=t.label.length>10?t.label.substring(0,10)+"...":t.label,i.appendChild(h)})),t.appendChild(i)}function generatePieChart(t,e,n,a,r){const s=n/2,o=a/2,i=Math.min(n,a)/3,l=e.reduce(((t,e)=>t+e.value),0);let d=-Math.PI/2;const c=document.createElementNS("http://www.w3.org/2000/svg","g");c.setAttribute("class","pie-chart"),e.forEach(((t,e)=>{const n=t.value/l*2*Math.PI,a=d+n,r=s+i*Math.cos(d),u=o+i*Math.sin(d),h=s+i*Math.cos(a),m=o+i*Math.sin(a),b=n>Math.PI?1:0,p=[`M ${s} ${o}`,`L ${r} ${u}`,`A ${i} ${i} 0 ${b} 1 ${h} ${m}`,"Z"].join(" "),g=document.createElementNS("http://www.w3.org/2000/svg","path");g.setAttribute("d",p),g.setAttribute("fill",t.color),g.setAttribute("stroke","#ffffff"),g.setAttribute("stroke-width","2"),g.addEventListener("mouseenter",(function(){this.style.opacity="0.8"})),g.addEventListener("mouseleave",(function(){this.style.opacity="1"})),c.appendChild(g);const f=d+n/2,w=.7*i,v=s+w*Math.cos(f),y=o+w*Math.sin(f),A=(t.value/l*100).toFixed(1);if(A>5){const t=document.createElementNS("http://www.w3.org/2000/svg","text");t.setAttribute("x",v),t.setAttribute("y",y),t.setAttribute("text-anchor","middle"),t.setAttribute("dominant-baseline","middle"),t.setAttribute("font-size","12"),t.setAttribute("font-weight","600"),t.setAttribute("fill","#ffffff"),t.textContent=`${A}%`,c.appendChild(t)}d=a})),t.appendChild(c),addPieLegend(t,e,n,a,r)}function addPieLegend(t,e,n,a,r){const s=document.createElementNS("http://www.w3.org/2000/svg","g");s.setAttribute("class","pie-legend");let o=50;e.forEach(((t,e)=>{const n=document.createElementNS("http://www.w3.org/2000/svg","rect");n.setAttribute("x",50),n.setAttribute("y",o-10),n.setAttribute("width",15),n.setAttribute("height",15),n.setAttribute("fill",t.color),n.setAttribute("rx","2"),s.appendChild(n);const a=document.createElementNS("http://www.w3.org/2000/svg","text");a.setAttribute("x",70),a.setAttribute("y",o+2),a.setAttribute("font-size","12"),a.setAttribute("fill",r),a.textContent=`${t.label}: ${t.value}`,s.appendChild(a),o+=25})),t.appendChild(s)}function addAxisLabels(t,e,n,a,r,s,o){const i=document.createElementNS("http://www.w3.org/2000/svg","text");i.setAttribute("x",a/2),i.setAttribute("y",r-20),i.setAttribute("text-anchor","middle"),i.setAttribute("font-size","14"),i.setAttribute("font-weight","600"),i.setAttribute("fill",o),i.textContent=e,t.appendChild(i);const l=document.createElementNS("http://www.w3.org/2000/svg","text");l.setAttribute("x",25),l.setAttribute("y",r/2),l.setAttribute("transform",`rotate(-90, 25, ${r/2})`),l.setAttribute("text-anchor","middle"),l.setAttribute("font-size","14"),l.setAttribute("font-weight","600"),l.setAttribute("fill",o),l.textContent=n,t.appendChild(l)}function addDataLabels(t,e,n,a,r,s,o,i){}function toggleDarkMode(){darkMode=!darkMode;const t=document.body,e=document.getElementById("darkModeToggle"),n=e.querySelector("i");darkMode?(t.classList.add("dark-theme"),n.className="fas fa-sun",e.title="Toggle light mode"):(t.classList.remove("dark-theme"),n.className="fas fa-moon",e.title="Toggle dark mode"),chartGenerated&&generateChart()}async function copySVG(){const t=document.getElementById("chart"),e=document.getElementById("copy-button"),n=e.innerHTML;try{e.innerHTML='<span class="loading-spinner"></span> Copying...',e.disabled=!0,t.setAttribute("xmlns","http://www.w3.org/2000/svg"),t.setAttribute("version","1.1");const a=(new XMLSerializer).serializeToString(t);await navigator.clipboard.writeText(a),e.innerHTML='<i class="fas fa-check"></i> Copied!',showMessage("SVG copied to clipboard!",!1,"success"),setTimeout((()=>{e.innerHTML=n,e.disabled=!1}),2e3)}catch(t){showMessage("Failed to copy SVG. Please try again.",!0,"error"),e.innerHTML=n,e.disabled=!1}}function downloadSVG(){const t=document.getElementById("chart");t.setAttribute("xmlns","http://www.w3.org/2000/svg"),t.setAttribute("version","1.1");const e=(new XMLSerializer).serializeToString(t),n=new Blob([e],{type:"image/svg+xml"}),a=URL.createObjectURL(n),r=document.createElement("a");r.href=a,r.download="chart.svg",document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(a),showMessage("SVG downloaded successfully!",!1,"success")}function downloadPNG(){const t=document.getElementById("chart"),e=document.createElement("canvas"),n=e.getContext("2d"),a=new Image;e.width=1200,e.height=600,t.setAttribute("xmlns","http://www.w3.org/2000/svg"),t.setAttribute("version","1.1");const r=(new XMLSerializer).serializeToString(t),s=new Blob([r],{type:"image/svg+xml;charset=utf-8"}),o=URL.createObjectURL(s);a.onload=function(){n.fillStyle=document.body.classList.contains("dark-theme")?"#1f2937":"#ffffff",n.fillRect(0,0,e.width,e.height),n.drawImage(a,0,0,e.width,e.height),e.toBlob((function(t){const e=URL.createObjectURL(t),n=document.createElement("a");n.href=e,n.download="chart.png",document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(e),URL.revokeObjectURL(o),showMessage("PNG downloaded successfully!",!1,"success")}))},a.onerror=function(){showMessage("Failed to generate PNG. Please try again.",!0,"error"),URL.revokeObjectURL(o)},a.src=o}document.addEventListener("DOMContentLoaded",(function(){updateUI(),generateChart()})),document.addEventListener("keydown",(function(t){if(t.ctrlKey||t.metaKey)switch(t.key){case"Enter":t.preventDefault(),generateChart();break;case"n":t.preventDefault(),addEntry();break;case"d":t.preventDefault(),toggleDarkMode();break;case"c":chartGenerated&&(t.preventDefault(),copySVG());break}})),document.getElementById("xLabel").addEventListener("input",(function(){chartGenerated&&generateChart()})),document.getElementById("yLabel").addEventListener("input",(function(){chartGenerated&&generateChart()})),document.getElementById("chartType").addEventListener("change",(function(){chartGenerated&&generateChart()}));