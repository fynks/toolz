class ChartGenerator{constructor(){this.data=[],this.chartGenerated=!1,this.draggedIndex=null,this.init()}init(){this.cacheElements(),this.attachEventListeners(),this.updateUI()}cacheElements(){this.elements={entries:document.getElementById("entries"),entriesSection:document.getElementById("entriesSection"),chart:document.getElementById("chart"),chartContainer:document.getElementById("chart-container"),emptyState:document.getElementById("emptyState"),exportOptions:document.getElementById("exportOptions"),entryCount:document.getElementById("entryCount"),xLabel:document.getElementById("xLabel"),yLabel:document.getElementById("yLabel"),chartType:document.getElementById("chartType"),message:document.getElementById("message"),messageText:document.getElementById("messageText"),darkModeToggle:document.getElementById("darkModeToggle"),copyButton:document.getElementById("copy-button")}}attachEventListeners(){document.addEventListener("keydown",(e=>this.handleKeyboardShortcuts(e)))}handleKeyboardShortcuts(e){if(e.ctrlKey||e.metaKey)switch(e.key){case"Enter":e.preventDefault(),this.generateChart();break;case"n":e.preventDefault(),this.addEntry();break;case"d":e.preventDefault(),this.toggleDarkMode();break;case"c":this.chartGenerated&&(e.preventDefault(),this.copySVG());break}}showMessage(e,t="success"){const a=this.elements.message.querySelector("i");this.elements.messageText.textContent=e,this.elements.message.className="",this.elements.message.classList.add(`toast-${t}`,"show"),a.className={success:"fas fa-check-circle",error:"fas fa-exclamation-circle",warning:"fas fa-exclamation-triangle",info:"fas fa-info-circle"}[t],setTimeout((()=>{this.elements.message.classList.remove("show")}),3e3)}updateUI(){const e=this.data.length>0;this.elements.entriesSection.style.display=e?"block":"none",this.elements.entryCount.textContent=this.data.length,this.chartGenerated&&e?(this.elements.exportOptions.style.display="flex",this.elements.emptyState.style.display="none",this.elements.chart.style.display="block"):(this.elements.exportOptions.style.display="none",this.elements.emptyState.style.display="flex",this.elements.chart.style.display="none")}addEntry(){const e={label:`Item ${this.data.length+1}`,value:Math.floor(100*Math.random())+1,color:this.getRandomColor()};this.data.push(e),this.refreshEntries(),this.updateUI()}removeEntry(e){this.data.length<=1?this.showMessage("Cannot remove the last entry. Add more entries first.","error"):e>=0&&e<this.data.length&&(this.data.splice(e,1),this.refreshEntries(),this.updateUI())}updateData(e,t,a){if(!(e>=this.data.length))if("value"===t){const n=parseFloat(a);if(isNaN(n)||n<0)return void this.showMessage("Please enter a valid positive number","error");this.data[e][t]=n}else this.data[e][t]=a}refreshEntries(){this.elements.entries.innerHTML="",this.data.forEach(((e,t)=>{const a=document.createElement("div");a.className="entry-item",a.draggable=!0,a.dataset.index=t,a.innerHTML=`\n                <div class="drag-handle" title="Drag to reorder">\n                    <i class="fas fa-grip-vertical"></i>\n                </div>\n                <input type="text" \n                       class="form-input" \n                       placeholder="Enter label" \n                       value="${this.escapeHtml(e.label)}" \n                       data-index="${t}"\n                       data-field="label">\n                <input type="number" \n                       class="form-input" \n                       placeholder="Enter value" \n                       value="${e.value}" \n                       min="0"\n                       step="0.1"\n                       data-index="${t}"\n                       data-field="value">\n                <div class="color-input-wrapper">\n                    <input type="color" \n                           class="color-input" \n                           value="${e.color}" \n                           data-index="${t}"\n                           data-field="color"\n                           title="Choose color">\n                </div>\n                <button class="btn btn-danger" \n                        data-index="${t}"\n                        data-action="remove"\n                        title="Remove entry"\n                        aria-label="Remove entry">\n                    <i class="fas fa-times"></i>\n                </button>\n            `,this.attachEntryListeners(a),this.elements.entries.appendChild(a)}))}attachEntryListeners(e){e.querySelectorAll("input[data-field]").forEach((e=>{e.addEventListener("change",(e=>{const t=parseInt(e.target.dataset.index),a=e.target.dataset.field;this.updateData(t,a,e.target.value)})),e.addEventListener("input",(e=>{this.validateInput(e.target)}))}));e.querySelector('[data-action="remove"]').addEventListener("click",(e=>{const t=parseInt(e.currentTarget.dataset.index);this.removeEntry(t)})),e.addEventListener("dragstart",(e=>this.handleDragStart(e))),e.addEventListener("dragover",(e=>this.handleDragOver(e))),e.addEventListener("drop",(e=>this.handleDrop(e))),e.addEventListener("dragend",(e=>this.handleDragEnd(e)))}handleDragStart(e){this.draggedIndex=parseInt(e.currentTarget.dataset.index),e.currentTarget.classList.add("dragging"),e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/html",e.currentTarget.innerHTML)}handleDragOver(e){e.preventDefault(),e.dataTransfer.dropEffect="move";parseInt(e.currentTarget.dataset.index)!==this.draggedIndex&&e.currentTarget.classList.add("drag-over")}handleDrop(e){e.preventDefault(),e.stopPropagation();const t=parseInt(e.currentTarget.dataset.index);if(null!==this.draggedIndex&&t!==this.draggedIndex){const[e]=this.data.splice(this.draggedIndex,1);this.data.splice(t,0,e),this.refreshEntries(),this.showMessage("Entry reordered successfully","success")}e.currentTarget.classList.remove("drag-over")}handleDragEnd(e){e.currentTarget.classList.remove("dragging"),document.querySelectorAll(".entry-item").forEach((e=>{e.classList.remove("drag-over")})),this.draggedIndex=null}validateInput(e){const t=e.value.trim();return"number"===e.type&&(isNaN(t)||t<0)?(e.style.borderColor="var(--danger-color)",!1):"text"===e.type&&""===t?(e.style.borderColor="var(--warning-color)",!1):(e.style.borderColor="var(--border-color)",!0)}getRandomColor(){const e=["#4f46e5","#7c3aed","#dc2626","#ea580c","#d97706","#ca8a04","#65a30d","#16a34a","#059669","#0891b2","#0284c7","#2563eb","#4338ca","#7c2d12","#a21caf"];return e[Math.floor(Math.random()*e.length)]}escapeHtml(e){const t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return e.replace(/[&<>"']/g,(e=>t[e]))}generateChart(){if(0===this.data.length)return void this.addSampleData();const e=this.elements.xLabel.value.trim()||"Categories",t=this.elements.yLabel.value.trim()||"Values",a=this.elements.chartType.value,n=this.data.filter((e=>""!==e.label.trim()&&!isNaN(e.value)&&e.value>=0));if(0===n.length)return void this.showMessage("Please add valid data entries with labels and positive values","error");this.elements.chart.innerHTML="";const s=900,r=500;this.elements.chart.setAttribute("viewBox","0 0 900 500"),this.elements.chart.setAttribute("preserveAspectRatio","xMidYMid meet");const i={top:50,right:50,bottom:120,left:80},l=s-i.left-i.right,o=r-i.top-i.bottom,d=Math.max(...n.map((e=>e.value)),1),c=document.body.classList.contains("dark-theme"),h=c?"#f9fafb":"#111827",m=c?"#6b7280":"#9ca3af",g=c?"#1f2937":"#ffffff",p=this.createSVGElement("rect",{width:s,height:r,fill:g});switch(this.elements.chart.appendChild(p),this.addGridLines(i,l,o,s,r,d,m,h),this.addAxes(i,l,o,s,r,h),a){case"bar":this.generateBarChart(n,i,l,o,d,h);break;case"line":this.generateLineChart(n,i,l,o,d,h);break;case"pie":this.generatePieChart(n,s,r,h);break}"pie"!==a&&this.addAxisLabels(e,t,s,r,i,h),this.chartGenerated=!0,this.updateUI(),this.showMessage("Chart generated successfully!","success")}addSampleData(){this.data=[{label:"Product A",value:45,color:"#4f46e5"},{label:"Product B",value:30,color:"#7c3aed"},{label:"Product C",value:25,color:"#dc2626"},{label:"Product D",value:60,color:"#16a34a"}],this.refreshEntries(),this.updateUI(),this.generateChart()}createSVGElement(e,t={}){const a=document.createElementNS("http://www.w3.org/2000/svg",e);return Object.entries(t).forEach((([e,t])=>{a.setAttribute(e,t)})),a}addGridLines(e,t,a,n,s,r,i,l){const o=this.createSVGElement("g",{class:"grid"});for(let t=0;t<=5;t++){const s=e.top+a/5*t,d=this.createSVGElement("line",{x1:e.left,y1:s,x2:n-e.right,y2:s,stroke:i,"stroke-width":"1",opacity:"0.5"});o.appendChild(d);const c=r-r/5*t,h=this.createSVGElement("text",{x:e.left-10,y:s+5,"text-anchor":"end","font-size":"12",fill:l});h.textContent=Math.round(10*c)/10,o.appendChild(h)}this.elements.chart.appendChild(o)}addAxes(e,t,a,n,s,r){const i=this.createSVGElement("line",{x1:e.left,y1:s-e.bottom,x2:n-e.right,y2:s-e.bottom,stroke:r,"stroke-width":"2"});this.elements.chart.appendChild(i);const l=this.createSVGElement("line",{x1:e.left,y1:e.top,x2:e.left,y2:s-e.bottom,stroke:r,"stroke-width":"2"});this.elements.chart.appendChild(l)}generateBarChart(e,t,a,n,s,r){const i=a/e.length*.8,l=a/e.length*.2,o=this.createSVGElement("g",{class:"bars"});e.forEach(((e,a)=>{const d=Math.max(e.value/s*n,2),c=t.left+a*(i+l)+l/2,h=t.top+n-d,m=this.createSVGElement("rect",{x:c,y:h,width:i,height:d,fill:e.color,rx:"4",class:"chart-bar",style:"transition: opacity 0.2s, transform 0.2s; cursor: pointer;"});m.addEventListener("mouseenter",(function(){this.style.opacity="0.8",this.style.transform="translateY(-2px)"})),m.addEventListener("mouseleave",(function(){this.style.opacity="1",this.style.transform="translateY(0)"})),o.appendChild(m);const g=this.createSVGElement("text",{x:c+i/2,y:h-8,"text-anchor":"middle","font-size":"12","font-weight":"600",fill:r});g.textContent=e.value,o.appendChild(g);const p=this.createSVGElement("text",{x:c+i/2,y:t.top+n+20,"text-anchor":"middle","font-size":"12",fill:r});p.textContent=e.label.length>10?e.label.substring(0,10)+"...":e.label,o.appendChild(p)})),this.elements.chart.appendChild(o)}generateLineChart(e,t,a,n,s,r){if(e.length<2)return void this.showMessage("Line chart requires at least 2 data points","warning");const i=this.createSVGElement("g",{class:"line-chart"}),l=e.map(((r,i)=>`${t.left+i*a/(e.length-1)},${t.top+n-r.value/s*n}`)).join(" "),o=this.createSVGElement("polyline",{points:l,fill:"none",stroke:"#4f46e5","stroke-width":"3","stroke-linecap":"round","stroke-linejoin":"round"});i.appendChild(o),e.forEach(((l,o)=>{const d=t.left+o*a/(e.length-1),c=t.top+n-l.value/s*n,h=this.createSVGElement("circle",{cx:d,cy:c,r:"6",fill:l.color,stroke:"#ffffff","stroke-width":"2",style:"transition: r 0.2s; cursor: pointer;"});h.addEventListener("mouseenter",(function(){this.setAttribute("r","8")})),h.addEventListener("mouseleave",(function(){this.setAttribute("r","6")})),i.appendChild(h);const m=this.createSVGElement("text",{x:d,y:t.top+n+20,"text-anchor":"middle","font-size":"12",fill:r});m.textContent=l.label.length>10?l.label.substring(0,10)+"...":l.label,i.appendChild(m)})),this.elements.chart.appendChild(i)}generatePieChart(e,t,a,n){const s=t/2,r=a/2,i=Math.min(t,a)/3,l=e.reduce(((e,t)=>e+t.value),0);let o=-Math.PI/2;const d=this.createSVGElement("g",{class:"pie-chart"});e.forEach((e=>{const t=e.value/l*2*Math.PI,a=o+t,n=s+i*Math.cos(o),c=r+i*Math.sin(o),h=s+i*Math.cos(a),m=r+i*Math.sin(a),g=t>Math.PI?1:0,p=[`M ${s} ${r}`,`L ${n} ${c}`,`A ${i} ${i} 0 ${g} 1 ${h} ${m}`,"Z"].join(" "),u=this.createSVGElement("path",{d:p,fill:e.color,stroke:"#ffffff","stroke-width":"2",style:"transition: opacity 0.2s; cursor: pointer;"});u.addEventListener("mouseenter",(function(){this.style.opacity="0.8"})),u.addEventListener("mouseleave",(function(){this.style.opacity="1"})),d.appendChild(u);const f=o+t/2,y=.7*i,v=s+y*Math.cos(f),b=r+y*Math.sin(f),x=(e.value/l*100).toFixed(1);if(x>5){const e=this.createSVGElement("text",{x:v,y:b,"text-anchor":"middle","dominant-baseline":"middle","font-size":"12","font-weight":"600",fill:"#ffffff"});e.textContent=`${x}%`,d.appendChild(e)}o=a})),this.elements.chart.appendChild(d),this.addPieLegend(e,t,a,n)}addPieLegend(e,t,a,n){const s=this.createSVGElement("g",{class:"pie-legend"});let r=50;e.forEach((e=>{const t=this.createSVGElement("rect",{x:50,y:r-10,width:15,height:15,fill:e.color,rx:"2"});s.appendChild(t);const a=this.createSVGElement("text",{x:70,y:r+2,"font-size":"12",fill:n});a.textContent=`${e.label}: ${e.value}`,s.appendChild(a),r+=25})),this.elements.chart.appendChild(s)}addAxisLabels(e,t,a,n,s,r){const i=this.createSVGElement("text",{x:a/2,y:n-20,"text-anchor":"middle","font-size":"14","font-weight":"600",fill:r});i.textContent=e,this.elements.chart.appendChild(i);const l=this.createSVGElement("text",{x:25,y:n/2,transform:`rotate(-90, 25, ${n/2})`,"text-anchor":"middle","font-size":"14","font-weight":"600",fill:r});l.textContent=t,this.elements.chart.appendChild(l)}toggleDarkMode(){const e=document.body,t=this.elements.darkModeToggle.querySelector("i");e.classList.toggle("dark-theme");const a=e.classList.contains("dark-theme");t.className=a?"fas fa-sun":"fas fa-moon",this.elements.darkModeToggle.title=a?"Toggle light mode":"Toggle dark mode",this.chartGenerated&&this.data.length>0&&this.generateChart()}async copySVG(){const e=this.elements.copyButton.innerHTML;try{this.elements.copyButton.innerHTML='<span class="loading-spinner"></span> Copying...',this.elements.copyButton.disabled=!0,this.elements.chart.setAttribute("xmlns","http://www.w3.org/2000/svg"),this.elements.chart.setAttribute("version","1.1");const t=(new XMLSerializer).serializeToString(this.elements.chart);await navigator.clipboard.writeText(t),this.elements.copyButton.innerHTML='<i class="fas fa-check"></i> Copied!',this.showMessage("SVG copied to clipboard!","success"),setTimeout((()=>{this.elements.copyButton.innerHTML=e,this.elements.copyButton.disabled=!1}),2e3)}catch(t){this.showMessage("Failed to copy SVG. Please try again.","error"),this.elements.copyButton.innerHTML=e,this.elements.copyButton.disabled=!1}}downloadSVG(){this.elements.chart.setAttribute("xmlns","http://www.w3.org/2000/svg"),this.elements.chart.setAttribute("version","1.1");const e=(new XMLSerializer).serializeToString(this.elements.chart),t=new Blob([e],{type:"image/svg+xml"}),a=URL.createObjectURL(t),n=document.createElement("a");n.href=a,n.download="chart.svg",document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(a),this.showMessage("SVG downloaded successfully!","success")}downloadPNG(){const e=document.createElement("canvas"),t=e.getContext("2d"),a=new Image;e.width=1200,e.height=600,this.elements.chart.setAttribute("xmlns","http://www.w3.org/2000/svg"),this.elements.chart.setAttribute("version","1.1");const n=(new XMLSerializer).serializeToString(this.elements.chart),s=new Blob([n],{type:"image/svg+xml;charset=utf-8"}),r=URL.createObjectURL(s);a.onload=()=>{const n=document.body.classList.contains("dark-theme");t.fillStyle=n?"#1f2937":"#ffffff",t.fillRect(0,0,e.width,e.height),t.drawImage(a,0,0,e.width,e.height),e.toBlob((e=>{const t=URL.createObjectURL(e),a=document.createElement("a");a.href=t,a.download="chart.png",document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(t),URL.revokeObjectURL(r),this.showMessage("PNG downloaded successfully!","success")}))},a.onerror=()=>{this.showMessage("Failed to generate PNG. Please try again.","error"),URL.revokeObjectURL(r)},a.src=r}}let chartGenerator;function addEntry(){chartGenerator.addEntry()}function generateChart(){chartGenerator.generateChart()}function toggleDarkMode(){chartGenerator.toggleDarkMode()}function copySVG(){chartGenerator.copySVG()}function downloadSVG(){chartGenerator.downloadSVG()}function downloadPNG(){chartGenerator.downloadPNG()}document.addEventListener("DOMContentLoaded",(()=>{chartGenerator=new ChartGenerator}));