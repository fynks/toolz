(()=>{"use strict";const e=Object.freeze({DARK:"dark",LIGHT:"light"}),t=Object.freeze({MARKDOWN:"markdown",JSON:"json",HTML:"html"}),r=Object.freeze({CENTER:"center",RIGHT:"right",LEFT:"left"}),n=Object.freeze({[r.CENTER]:":---:",[r.RIGHT]:"---:",[r.LEFT]:":---"}),o=Object.freeze({SUCCESS:"success",ERROR:"error",WARNING:"warning",INFO:"info"}),a={themeToggle:document.getElementById("themeToggle"),get sunPath(){return this.themeToggle?.querySelector(".sun")},get moonPath(){return this.themeToggle?.querySelector(".moon")},inputTextArea:document.getElementById("input"),outputTextArea:document.getElementById("output"),tableContainer:document.getElementById("tableContainer"),analysisSection:document.getElementById("analysisSection"),analysisMarkdownOutput:document.getElementById("analysisMarkdownOutput"),parseBtn:document.getElementById("parseBtn"),analyzeBtn:document.getElementById("analyzeBtn"),copyBtn:document.getElementById("copyBtn"),clearBtn:document.getElementById("clearBtn"),addColumnBtn:document.getElementById("addColumnBtn"),addRowBtn:document.getElementById("addRowBtn"),sortRowsBtn:document.getElementById("sortRowsBtn"),removeColumnBtn:document.getElementById("removeColumnBtn"),removeRowBtn:document.getElementById("removeRowBtn"),reorderBtn:document.getElementById("reorderBtn"),notificationDiv:document.getElementById("notification")};const s=new class{constructor(){this.headers=[],this.rows=[],this.alignments=[],this.isReorderMode=!1,this.outputFormat=t.MARKDOWN,this.history=[],this.historyIndex=-1}saveToHistory(){const e={headers:[...this.headers],rows:this.rows.map((e=>[...e])),alignments:[...this.alignments]};this.history=this.history.slice(0,this.historyIndex+1),this.history.push(e),this.historyIndex++,this.history.length>50&&(this.history.shift(),this.historyIndex--)}undo(){if(this.historyIndex>0){this.historyIndex--;const e=this.history[this.historyIndex];return this.headers=[...e.headers],this.rows=e.rows.map((e=>[...e])),this.alignments=[...e.alignments],!0}return!1}redo(){if(this.historyIndex<this.history.length-1){this.historyIndex++;const e=this.history[this.historyIndex];return this.headers=[...e.headers],this.rows=e.rows.map((e=>[...e])),this.alignments=[...e.alignments],!0}return!1}reset(){this.headers=[],this.rows=[],this.alignments=[],this.isReorderMode=!1,this.outputFormat=t.MARKDOWN,this.history=[],this.historyIndex=-1}isEmpty(){return 0===this.headers.length&&0===this.rows.length}isValid(){return this.headers.length>0&&this.alignments.length===this.headers.length}},i=e=>"string"!=typeof e?"":e.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"),d=(e,t)=>{let r;return(...n)=>{clearTimeout(r),r=setTimeout((()=>e.apply(this,n)),t)}},l=async e=>{try{return await navigator.clipboard.writeText(e),!0}catch(t){const r=document.createElement("textarea");r.value=e,r.style.position="fixed",r.style.opacity="0",document.body.appendChild(r),r.select();const n=document.execCommand("copy");return document.body.removeChild(r),n}},c=(e,t=o.SUCCESS,r=3e3)=>{if(!a.notificationDiv)return;const n={[o.SUCCESS]:"#4CAF50",[o.ERROR]:"#dc3545",[o.WARNING]:"#ff9800",[o.INFO]:"#2196F3"};a.notificationDiv.textContent=e,a.notificationDiv.style.backgroundColor=n[t]||n[o.SUCCESS],a.notificationDiv.style.display="block",a.notificationDiv.setAttribute("aria-live","polite"),setTimeout((()=>{a.notificationDiv.style.display="none"}),r)},h={toggle:()=>{const t=document.documentElement.getAttribute("data-theme")===e.DARK?e.LIGHT:e.DARK;h.set(t)},set:e=>{document.documentElement.setAttribute("data-theme",e),localStorage.setItem("theme",e),h.updateIcons(e)},updateIcons:t=>{a.sunPath&&a.moonPath&&(a.sunPath.style.display=t===e.DARK?"block":"none",a.moonPath.style.display=t===e.DARK?"none":"block")},init:()=>{const t=localStorage.getItem("theme")||(window.matchMedia("(prefers-color-scheme: dark)").matches?e.DARK:e.LIGHT);h.set(t)}},u={parse:e=>{if(!e?.trim())throw new Error("Please enter a markdown or HTML table");const t=e.trim();return t.toLowerCase().includes("<table")?u.parseHTML(t):u.parseMarkdown(t)},parseMarkdown:e=>{const t=e.trim().split("\n").filter((e=>e.trim()));if(t.length<2)throw new Error("Markdown table must have at least a header and separator row");const n=u.parseRow(t[0]),o=u.parseRow(t[1]);if(n.length!==o.length)throw new Error("Header and separator row must have the same number of columns");const a=o.map((e=>{const t=e.trim();return t.startsWith(":")&&t.endsWith(":")?r.CENTER:t.endsWith(":")?r.RIGHT:r.LEFT})),s=t.slice(2).map(((e,t)=>{const r=u.parseRow(e);if(r.length!==n.length){for(;r.length<n.length;)r.push("");r.length>n.length&&r.splice(n.length)}return r}));return{headers:n.map(i),alignments:a,rows:s.map((e=>e.map(i)))}},parseHTML:e=>{try{const t=document.createElement("div");t.innerHTML=e;const n=t.querySelector("table");if(!n)throw new Error("No table element found in HTML input");const o=n.querySelector("thead tr")||n.querySelector("tr");if(!o)throw new Error("No header row found in HTML table");const a=Array.from(o.querySelectorAll("th, td")).map((e=>e.textContent.trim()));if(0===a.length)throw new Error("No headers found in HTML table");const s=Array.from(o.querySelectorAll("th, td")).map((e=>{const t=e.classList,n=e.style.textAlign||"";return t.contains("text-center")||"center"===n?r.CENTER:t.contains("text-right")||"right"===n?r.RIGHT:r.LEFT})),d=n.querySelector("tbody"),l=(d?Array.from(d.querySelectorAll("tr")):Array.from(n.querySelectorAll("tr")).slice(1)).map(((e,t)=>{const r=Array.from(e.querySelectorAll("td, th")).map((e=>e.textContent.trim()));if(r.length!==a.length){for(;r.length<a.length;)r.push("");r.length>a.length&&r.splice(a.length)}return r}));return{headers:a.map(i),alignments:s,rows:l.map((e=>e.map(i)))}}catch(e){throw new Error(`Error parsing HTML table: ${e.message}`)}},parseRow:e=>e.split("|").filter(((e,t,r)=>!(0===t&&""===e.trim()||t===r.length-1&&""===e.trim()))).map((e=>e.trim()))},m={[t.MARKDOWN]:()=>{const e=`| ${s.alignments.map((e=>n[e])).join(" | ")} |`;return[`| ${s.headers.join(" | ")} |`,e,s.rows.map((e=>`| ${e.join(" | ")} |`)).join("\n")].filter(Boolean).join("\n")},[t.JSON]:()=>{const e={};return s.rows.forEach((t=>{const r=t[0]?.replace(/\*\*/g,"");if(r){e[r]={};for(let n=1;n<s.headers.length;n++){const o=s.headers[n].replace(/\*\*/g,"");e[r][o]=t[n]?t[n].toLowerCase():"no"}}})),JSON.stringify(e,null,2)},[t.HTML]:()=>{const e=e=>e!==r.LEFT?` class="text-${e}"`:"";return`<table>\n<thead>\n<tr>${s.headers.map(((t,r)=>`<th${e(s.alignments[r])}>${t}</th>`)).join("")}</tr>\n</thead>\n<tbody>\n${s.rows.map((t=>`<tr>${t.map(((t,r)=>`<td${e(s.alignments[r])}>${t}</td>`)).join("")}</tr>`)).join("")}\n</tbody>\n</table>`}},g={render:()=>{if(!s.isValid())return void(a.tableContainer.innerHTML="");const e=g.createTable();a.tableContainer.innerHTML="",a.tableContainer.appendChild(e),w.generate()},createTable:()=>{const e=document.createElement("table");return e.appendChild(g.createHeader()),e.appendChild(g.createBody()),e},createHeader:()=>{const e=document.createElement("thead"),t=document.createElement("tr");return s.headers.forEach(((e,r)=>{const n=g.createHeaderCell(e,r);t.appendChild(n)})),e.appendChild(t),e},createHeaderCell:(e,t)=>{const r=document.createElement("th");return r.textContent=e,r.draggable=s.isReorderMode,r.dataset.index=t,r.classList.toggle("dragging-allowed",s.isReorderMode),r.contentEditable=!s.isReorderMode,r.tabIndex=s.isReorderMode?-1:0,s.isReorderMode&&(r.addEventListener("dragstart",p.handleDragStart),r.addEventListener("dragover",p.handleDragOver),r.addEventListener("drop",p.handleDrop)),r.addEventListener("blur",(()=>{s.isReorderMode||(s.saveToHistory(),s.headers[t]=i(r.textContent),w.generate())})),r.addEventListener("keydown",(e=>{"Enter"!==e.key||s.isReorderMode||(e.preventDefault(),r.blur())})),r},createBody:()=>{const e=document.createElement("tbody");return s.rows.forEach(((t,r)=>{const n=g.createRow(t,r);e.appendChild(n)})),e},createRow:(e,t)=>{const r=document.createElement("tr");return r.draggable=s.isReorderMode,r.dataset.index=t,r.classList.toggle("dragging-allowed",s.isReorderMode),s.isReorderMode&&(r.addEventListener("dragstart",p.handleDragStart),r.addEventListener("dragover",p.handleDragOver),r.addEventListener("drop",p.handleDrop)),e.forEach(((e,n)=>{const o=g.createCell(e,t,n);r.appendChild(o)})),r},createCell:(e,t,r)=>{const n=document.createElement("td");return n.contentEditable=!s.isReorderMode,n.tabIndex=s.isReorderMode?-1:0,n.textContent=e,n.addEventListener("blur",(()=>{s.isReorderMode||(s.saveToHistory(),s.rows[t][r]=i(n.textContent),w.generate())})),n.addEventListener("keydown",(e=>{"Enter"!==e.key||s.isReorderMode||(e.preventDefault(),n.blur())})),n}},p={handleDragStart:e=>{e.target.classList.add("dragging"),e.dataTransfer.setData("text/plain",e.target.dataset.index),e.dataTransfer.setData("type",e.target.tagName.toLowerCase())},handleDragOver:e=>{e.preventDefault();if("tr"===e.dataTransfer.getData("type")){const t=a.tableContainer.querySelector("tbody"),r=p.getDragAfterElement(t,e.clientY),n=document.querySelector(".dragging");null==r?t.appendChild(n):t.insertBefore(n,r)}},handleDrop:e=>{e.preventDefault();const t=parseInt(e.dataTransfer.getData("text/plain")),r=parseInt(e.target.dataset.index),n=e.dataTransfer.getData("type");if(t!==r){if(s.saveToHistory(),"th"===n)y.reorderColumns(t,r);else if("tr"===n){const e=a.tableContainer.querySelector("tbody"),r=e.querySelector("tr.dragging");if(r){const n=Array.from(e.children).indexOf(r);y.reorderRows(t,n)}}g.render(),E.analyze()}document.querySelectorAll(".dragging").forEach((e=>{e.classList.remove("dragging")}))},getDragAfterElement:(e,t)=>[...e.querySelectorAll("tr:not(.dragging)")].reduce(((e,r)=>{const n=r.getBoundingClientRect(),o=t-n.top-n.height/2;return o<0&&o>e.offset?{offset:o,element:r}:e}),{offset:Number.NEGATIVE_INFINITY}).element},y={addColumn:()=>{s.isReorderMode||(s.saveToHistory(),s.headers.push("New Column"),s.alignments.push(r.LEFT),s.rows.forEach((e=>e.push(""))),g.render(),c("Column added"))},addRow:()=>{if(s.isReorderMode)return;s.saveToHistory();const e=Array(s.headers.length).fill("");s.rows.push(e),g.render(),c("Row added")},removeColumn:()=>{if(s.isReorderMode)return;if(s.headers.length<=1)return void c("Cannot remove the last column",o.ERROR);s.saveToHistory();const e=s.headers.length-1;s.headers.splice(e,1),s.alignments.splice(e,1),s.rows.forEach((t=>t.splice(e,1))),g.render(),E.analyze(),c("Column removed")},removeRow:()=>{s.isReorderMode||(0!==s.rows.length?(s.saveToHistory(),s.rows.pop(),g.render(),E.analyze(),c("Row removed")):c("No rows to remove",o.ERROR))},sortRows:()=>{s.isReorderMode||(s.rows.length?(s.saveToHistory(),s.rows.sort(((e,t)=>(e[0]?.toLowerCase()||"").localeCompare(t[0]?.toLowerCase()||""))),g.render(),c("Rows sorted alphabetically")):c("No rows to sort",o.ERROR))},reorderColumns:(e,t)=>{const r=r=>{const n=r[e];r.splice(e,1),r.splice(t,0,n)};r(s.headers),r(s.alignments),s.rows.forEach((e=>r(e)))},reorderRows:(e,t)=>{const r=s.rows[e];s.rows.splice(e,1),s.rows.splice(t,0,r)},duplicateRow:e=>{if(s.isReorderMode)return;s.saveToHistory();const t=[...s.rows[e]];s.rows.splice(e+1,0,t),g.render(),c("Row duplicated")},insertRowAfter:e=>{if(s.isReorderMode)return;s.saveToHistory();const t=Array(s.headers.length).fill("");s.rows.splice(e+1,0,t),g.render(),c("Row inserted")}},w={generate:()=>{if(!s.isValid())return void(a.outputTextArea.value="");const e=m[s.outputFormat];a.outputTextArea.value=e?e():m[t.MARKDOWN]()},setFormat:e=>{Object.values(t).includes(e)&&(s.outputFormat=e,w.generate())}},E={analyze:()=>{if(0===s.rows.length||0===s.headers.length)return void(a.analysisMarkdownOutput.textContent="");const e=s.rows.length;let t=`| **Total** = \`${e}\` |`;for(let r=1;r<s.headers.length;r++){t+=` \`${s.rows.reduce(((e,t)=>e+("yes"===t[r]?.toLowerCase()?1:0)),0)}/${e}\` |`}a.analysisMarkdownOutput.textContent=t,c("Table analyzed!")},getColumnStats:e=>{if(e>=s.headers.length)return null;const t=s.rows.map((t=>t[e]||"")),r=[...new Set(t)],n=t.filter((e=>!e.trim())).length;return{columnName:s.headers[e],totalCells:t.length,uniqueValues:r.length,emptyCells:n,mostCommon:E.getMostCommonValue(t)}},getMostCommonValue:e=>{const t={};return e.forEach((e=>{t[e]=(t[e]||0)+1})),Object.entries(t).sort((([,e],[,t])=>t-e))[0]?.[0]||""}},f={init:()=>{h.init(),f.bindEvents(),f.initializeKeyboardShortcuts()},parseTable:()=>{const e=a.inputTextArea.value.trim();try{const t=u.parse(e);s.saveToHistory(),Object.assign(s,t),g.render(),c("Table parsed successfully!")}catch(e){c(`Error parsing table: ${e.message}`,o.ERROR)}},copyToClipboard:async()=>{const e=await l(a.outputTextArea.value);c(e?"Copied to clipboard!":"Failed to copy to clipboard",e?o.SUCCESS:o.ERROR)},clearAll:()=>{confirm("Are you sure you want to clear everything?")&&(a.inputTextArea.value="",a.outputTextArea.value="",a.tableContainer.innerHTML="",a.analysisMarkdownOutput.textContent="",s.reset(),c("All cleared"))},toggleReorderMode:()=>{s.isReorderMode=!s.isReorderMode,a.reorderBtn.textContent=s.isReorderMode?"Edit Table":"Re-order",g.render()},undo:()=>{s.undo()?(g.render(),E.analyze(),c("Undone",o.INFO)):c("Nothing to undo",o.WARNING)},redo:()=>{s.redo()?(g.render(),E.analyze(),c("Redone",o.INFO)):c("Nothing to redo",o.WARNING)},bindEvents:()=>{a.themeToggle?.addEventListener("click",h.toggle),a.parseBtn?.addEventListener("click",f.parseTable),a.analyzeBtn?.addEventListener("click",(()=>{E.analyze(),a.analysisSection&&(a.analysisSection.open=!0)})),a.copyBtn?.addEventListener("click",f.copyToClipboard),a.clearBtn?.addEventListener("click",f.clearAll),a.addColumnBtn?.addEventListener("click",y.addColumn),a.addRowBtn?.addEventListener("click",y.addRow),a.sortRowsBtn?.addEventListener("click",y.sortRows),a.removeColumnBtn?.addEventListener("click",y.removeColumn),a.removeRowBtn?.addEventListener("click",y.removeRow),a.reorderBtn?.addEventListener("click",f.toggleReorderMode),a.inputTextArea?.addEventListener("input",d(f.parseTable,300)),document.addEventListener("change",(e=>{"outputFormat"===e.target?.id&&w.setFormat(e.target.value)})),window.addEventListener("DOMContentLoaded",h.init),window.addEventListener("beforeunload",(e=>{s.isEmpty()||(e.preventDefault(),e.returnValue="")}))},initializeKeyboardShortcuts:()=>{document.addEventListener("keydown",(e=>{!e.ctrlKey&&!e.metaKey||"z"!==e.key||e.shiftKey||(e.preventDefault(),f.undo()),(e.ctrlKey||e.metaKey)&&("z"===e.key&&e.shiftKey||"y"===e.key)&&(e.preventDefault(),f.redo()),(e.ctrlKey||e.metaKey)&&"Enter"===e.key&&(e.preventDefault(),f.parseTable()),(e.ctrlKey||e.metaKey)&&e.shiftKey&&"C"===e.key&&(e.preventDefault(),f.copyToClipboard())}))}};f.init()})();