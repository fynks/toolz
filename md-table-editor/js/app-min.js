(()=>{"use strict";const e=Object.freeze({DARK:"dark",LIGHT:"light"}),t=Object.freeze({MARKDOWN:"markdown",JSON:"json",HTML:"html"}),r=Object.freeze({CENTER:"center",RIGHT:"right",LEFT:"left"}),n=Object.freeze({[r.CENTER]:":---:",[r.RIGHT]:"---:",[r.LEFT]:":---"}),o=Object.freeze({SUCCESS:"success",ERROR:"error",WARNING:"warning",INFO:"info"}),a={themeToggle:document.getElementById("themeToggle"),get sunPath(){return this.themeToggle?.querySelector(".sun")},get moonPath(){return this.themeToggle?.querySelector(".moon")},inputTextArea:document.getElementById("input"),outputTextArea:document.getElementById("output"),outputFormat:document.getElementById("outputFormat"),tableContainer:document.getElementById("tableContainer"),analysisSection:document.getElementById("analysisSection"),analysisMarkdownOutput:document.getElementById("analysisMarkdownOutput"),parseBtn:document.getElementById("parseBtn"),analyzeBtn:document.getElementById("analyzeBtn"),copyBtn:document.getElementById("copyBtn"),clearBtn:document.getElementById("clearBtn"),addColumnBtn:document.getElementById("addColumnBtn"),addRowBtn:document.getElementById("addRowBtn"),sortRowsBtn:document.getElementById("sortRowsBtn"),removeColumnBtn:document.getElementById("removeColumnBtn"),removeRowBtn:document.getElementById("removeRowBtn"),reorderBtn:document.getElementById("reorderBtn"),notificationDiv:document.getElementById("notification")};const s=new class{constructor(){this.reset()}saveToHistory(){const e={headers:[...this.headers],rows:this.rows.map((e=>[...e])),alignments:[...this.alignments]};this.history=this.history.slice(0,this.historyIndex+1),this.history.push(e),this.historyIndex++,this.history.length>50&&(this.history.shift(),this.historyIndex--)}undo(){if(this.historyIndex>0){this.historyIndex--;const e=this.history[this.historyIndex];return this.headers=[...e.headers],this.rows=e.rows.map((e=>[...e])),this.alignments=[...e.alignments],!0}return!1}redo(){if(this.historyIndex<this.history.length-1){this.historyIndex++;const e=this.history[this.historyIndex];return this.headers=[...e.headers],this.rows=e.rows.map((e=>[...e])),this.alignments=[...e.alignments],!0}return!1}reset(){this.headers=[],this.rows=[],this.alignments=[],this.isReorderMode=!1,this.outputFormat=t.MARKDOWN,this.history=[],this.historyIndex=-1}isEmpty(){return 0===this.headers.length&&0===this.rows.length}isValid(){return this.headers.length>0&&this.alignments.length===this.headers.length}},i=e=>"string"!=typeof e?String(e||""):e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"),d=(e,t)=>{let r;return(...n)=>{clearTimeout(r),r=setTimeout((()=>e.apply(this,n)),t)}},l=(e,t=o.SUCCESS,r=3e3)=>{if(!a.notificationDiv)return;const n={[o.SUCCESS]:"#4CAF50",[o.ERROR]:"#dc3545",[o.WARNING]:"#ff9800",[o.INFO]:"#2196F3"};a.notificationDiv.textContent=e,a.notificationDiv.style.backgroundColor=n[t]||n[o.SUCCESS],a.notificationDiv.style.display="block",a.notificationDiv.setAttribute("aria-live","polite"),setTimeout((()=>{a.notificationDiv.style.display="none"}),r)},f=e=>{const n=(e||"").toString().trim(),t=n.toLowerCase();return "yes"===t||"true"===t||"1"===t||"y"===t||"✅"===n||"✔️"===n||"✔"===n||"✓"===n},b=e=>{const n=(e||"").toString().trim(),t=n.toLowerCase();return "no"===t||"false"===t||"0"===t||"n"===t||"❌"===n||"✖️"===n||"✖"===n||"x"===n},c={toggle(){const t=document.documentElement.getAttribute("data-theme")===e.DARK?e.LIGHT:e.DARK;this.set(t)},set(e){document.documentElement.setAttribute("data-theme",e),localStorage.setItem("theme",e),this.updateIcons(e)},updateIcons(t){a.sunPath&&a.moonPath&&(a.sunPath.style.display=t===e.DARK?"block":"none",a.moonPath.style.display=t===e.DARK?"none":"block")},init(){const t=localStorage.getItem("theme")||(window.matchMedia("(prefers-color-scheme: dark)").matches?e.DARK:e.LIGHT);this.set(t)}},h={parse(e){if(!e?.trim())throw new Error("Please enter a markdown or HTML table");const t=e.trim(),r=this.detectHTMLTable(t),n=this.detectMarkdownTable(t);if(r)return this.parseHTML(t);if(n)return this.parseMarkdown(t);throw new Error("Input does not appear to be a valid HTML or Markdown table")},detectHTMLTable:e=>/<table[\s\S]*?<\/table>/i.test(e)||e.toLowerCase().includes("<table"),detectMarkdownTable(e){const t=e.split("\n").filter((e=>e.trim()));if(t.length<2)return!1;const r=t.some((e=>e.includes("|"))),n=t.some((e=>/^\s*\|?\s*:?-+:?\s*\|\s*/.test(e)));return r&&n},parseMarkdown(e){const t=e.trim().split("\n").filter((e=>e.trim()));if(t.length<2)throw new Error("Markdown table must have at least a header and separator row");const n=this.parseRow(t[0]),o=this.parseRow(t[1]);if(n.length!==o.length)throw new Error("Header and separator row must have the same number of columns");const a=o.map((e=>{const t=e.trim();return t.startsWith(":")&&t.endsWith(":")?r.CENTER:t.endsWith(":")?r.RIGHT:r.LEFT})),s=t.slice(2).map(((e,t)=>{const r=this.parseRow(e);if(r.length!==n.length){for(;r.length<n.length;)r.push("");r.length>n.length&&r.splice(n.length)}return r}));return{headers:n.map(i),alignments:a,rows:s.map((e=>e.map(i)))}},parseHTML(e){try{const t=document.createElement("div");t.innerHTML=e;const n=t.querySelector("table");if(!n)throw new Error("No table element found in HTML input");let o=n.querySelector("thead tr");if(o||(o=n.querySelector("tr:has(th)")),o||(o=n.querySelector("tr")),!o)throw new Error("No header row found in HTML table");const a=Array.from(o.querySelectorAll("th, td")).map((e=>e.textContent?.trim()||e.innerText?.trim()||""));if(0===a.length)throw new Error("No headers found in HTML table");const s=Array.from(o.querySelectorAll("th, td")).map((e=>{const t=e.classList,n=window.getComputedStyle(e),o=e.style.textAlign||"",a=n.textAlign||o;return t.contains("text-center")||t.contains("center")||"center"===a?r.CENTER:t.contains("text-right")||t.contains("right")||"right"===a?r.RIGHT:r.LEFT})),d=n.querySelector("tbody");let l;if(d)l=Array.from(d.querySelectorAll("tr"));else{const e=Array.from(n.querySelectorAll("tr")),t=e.indexOf(o);l=e.slice(t+1)}const c=l.map(((e,t)=>{const r=[];for(Array.from(e.querySelectorAll("td, th")).forEach((e=>{const t=parseInt(e.getAttribute("colspan")||"1",10),n=e.textContent?.trim()||e.innerText?.trim()||"";r.push(n);for(let e=1;e<t;e++)r.push("")}));r.length<a.length;)r.push("");return r.length>a.length&&r.splice(a.length),r}));return{headers:a.map(i),alignments:s,rows:c.map((e=>e.map(i)))}}catch(e){throw new Error(`Error parsing HTML table: ${e.message}`)}},parseRow:e=>e.split("|").filter(((e,t,r)=>!(0===t&&""===e.trim()||t===r.length-1&&""===e.trim()))).map((e=>e.trim()))},u={[t.MARKDOWN](){const e=`| ${s.alignments.map((e=>n[e])).join(" | ")} |`;return[`| ${s.headers.join(" | ")} |`,e,s.rows.map((e=>`| ${e.join(" | ")} |`)).join("\n")].filter(Boolean).join("\n")},[t.JSON](){const e={};return s.rows.forEach((t=>{const r=t[0]?.replace(/\*\*/g,"");if(r){e[r]={};for(let n=1;n<s.headers.length;n++){const o=s.headers[n].replace(/\*\*/g,"");e[r][o]=f(t[n])?"yes":"no"}}})),JSON.stringify(e,null,2)},[t.HTML](){const e=e=>e!==r.LEFT?` class="text-${e}"`:"";return`<table>\n<thead>\n<tr>${s.headers.map(((t,r)=>`<th${e(s.alignments[r])}>${t}</th>`)).join("")}</tr>\n</thead>\n<tbody>\n${s.rows.map((t=>`<tr>${t.map(((t,r)=>`<td${e(s.alignments[r])}>${t}</td>`)).join("")}</tr>`)).join("")}\n</tbody>\n</table>`}},m={render(){if(!s.isValid())return a.tableContainer.innerHTML="",void(a.outputTextArea.value="");const e=this.createTable();a.tableContainer.innerHTML="",a.tableContainer.appendChild(e),w.generate()},createTable(){const e=document.createElement("table");return e.appendChild(this.createHeader()),e.appendChild(this.createBody()),e},createHeader(){const e=document.createElement("thead"),t=document.createElement("tr");return s.headers.forEach(((e,r)=>{const n=this.createHeaderCell(e,r);t.appendChild(n)})),e.appendChild(t),e},createHeaderCell(e,t){const r=document.createElement("th");return r.textContent=e,r.draggable=s.isReorderMode,r.dataset.index=t,r.classList.toggle("dragging-allowed",s.isReorderMode),r.contentEditable=!s.isReorderMode,r.tabIndex=s.isReorderMode?-1:0,s.isReorderMode&&(r.addEventListener("dragstart",g.handleDragStart),r.addEventListener("dragover",g.handleDragOver),r.addEventListener("drop",g.handleDrop)),r.addEventListener("blur",(()=>{s.isReorderMode||(s.saveToHistory(),s.headers[t]=i(r.textContent),w.generate())})),r.addEventListener("keydown",(e=>{"Enter"!==e.key||s.isReorderMode||(e.preventDefault(),r.blur())})),r},createBody(){const e=document.createElement("tbody");return s.rows.forEach(((t,r)=>{const n=this.createRow(t,r);e.appendChild(n)})),e},createRow(e,t){const r=document.createElement("tr");return r.draggable=s.isReorderMode,r.dataset.index=t,r.classList.toggle("dragging-allowed",s.isReorderMode),s.isReorderMode&&(r.addEventListener("dragstart",g.handleDragStart),r.addEventListener("dragover",g.handleDragOver),r.addEventListener("drop",g.handleDrop)),e.forEach(((e,n)=>{const o=this.createCell(e,t,n);r.appendChild(o)})),r},createCell(e,t,r){const n=document.createElement("td");return n.contentEditable=!s.isReorderMode,n.tabIndex=s.isReorderMode?-1:0,n.textContent=e,n.dataset.row=t,n.dataset.col=r,n.addEventListener("blur",(()=>{s.isReorderMode||(s.saveToHistory(),s.rows[t][r]=i(n.textContent),w.generate())})),n.addEventListener("keydown",(e=>{"Enter"!==e.key||s.isReorderMode||(e.preventDefault(),n.blur())})),n}},g={handleDragStart(e){e.target.classList.add("dragging"),e.dataTransfer.setData("text/plain",e.target.dataset.index),e.dataTransfer.setData("type",e.target.tagName.toLowerCase())},handleDragOver(e){if(e.preventDefault(),"tr"===e.dataTransfer.getData("type")){const t=a.tableContainer.querySelector("tbody"),r=this.getDragAfterElement(t,e.clientY),n=document.querySelector(".dragging");r?t.insertBefore(n,r):t.appendChild(n)}},handleDrop(e){e.preventDefault();const t=parseInt(e.dataTransfer.getData("text/plain"),10),r=parseInt(e.target.dataset.index,10),n=e.dataTransfer.getData("type");if(t!==r){if(s.saveToHistory(),"th"===n)p.reorderColumns(t,r);else if("tr"===n){const e=a.tableContainer.querySelector("tbody"),r=e.querySelector("tr.dragging");if(r){const n=Array.from(e.children).indexOf(r);p.reorderRows(t,n)}}m.render()}document.querySelectorAll(".dragging").forEach((e=>e.classList.remove("dragging")))},getDragAfterElement:(e,t)=>[...e.querySelectorAll("tr:not(.dragging)")].reduce(((e,r)=>{const n=r.getBoundingClientRect(),o=t-n.top-n.height/2;return o<0&&o>e.offset?{offset:o,element:r}:e}),{offset:Number.NEGATIVE_INFINITY}).element},p={addColumn(){s.isReorderMode||(s.saveToHistory(),s.headers.push("New Column"),s.alignments.push(r.LEFT),s.rows.forEach((e=>e.push(""))),m.render(),w.generate(),l("Column added"))},addRow(){if(s.isReorderMode)return;if(0===s.headers.length)return void l("Please add headers first",o.ERROR);s.saveToHistory();const e=Array(s.headers.length).fill("");s.rows.push(e),m.render(),w.generate(),l("Row added")},removeColumn(){if(s.isReorderMode)return;if(s.headers.length<=1)return void l("Cannot remove the last column",o.ERROR);s.saveToHistory();const e=s.headers.length-1;s.headers.splice(e,1),s.alignments.splice(e,1),s.rows.forEach((t=>t.splice(e,1))),m.render(),w.generate(),y.analyze(),l("Column removed")},removeColumnAt(e){s.isReorderMode||(s.headers.length<=1?l("Cannot remove the last column",o.ERROR):e<0||e>=s.headers.length?l("Invalid column index",o.ERROR):(s.saveToHistory(),s.headers.splice(e,1),s.alignments.splice(e,1),s.rows.forEach((t=>t.splice(e,1))),m.render(),w.generate(),l("Column removed")))},removeRow(){s.isReorderMode||(s.rows.length>0?(s.saveToHistory(),s.rows.pop(),m.render(),w.generate(),l("Row removed")):l("No rows to remove",o.ERROR))},removeRowAt(e){s.isReorderMode||(e<0||e>=s.rows.length?l("Invalid row index",o.ERROR):s.rows.length>0?(s.saveToHistory(),s.rows.splice(e,1),m.render(),w.generate(),l("Row removed")):l("No rows to remove",o.ERROR))},sortRows(){s.isReorderMode||(s.rows.length>1?(s.saveToHistory(),s.rows.sort(((e,t)=>(e[0]?.toLowerCase()||"").localeCompare(t[0]?.toLowerCase()||""))),m.render(),w.generate(),l("Rows sorted alphabetically")):l("Need at least 2 rows to sort",o.ERROR))},reorderColumns(e,t){const r=r=>{const n=r[e];r.splice(e,1),r.splice(t,0,n)};r(s.headers),r(s.alignments),s.rows.forEach((e=>r(e)))},reorderRows(e,t){const r=s.rows[e];s.rows.splice(e,1),s.rows.splice(t,0,r)},duplicateRow(e){if(s.isReorderMode)return;s.saveToHistory();const t=[...s.rows[e]];s.rows.splice(e+1,0,t),m.render(),l("Row duplicated")},insertRowAfter(e){if(s.isReorderMode)return;s.saveToHistory();const t=Array(s.headers.length).fill("");s.rows.splice(e+1,0,t),m.render(),l("Row inserted")}},y={analyze(){if(0===s.rows.length||0===s.headers.length)return void(a.analysisMarkdownOutput.textContent="");const e=s.rows.length;let t=`| **Total** = \`${e}\` |`;for(let r=1;r<s.headers.length;r++){t+=` \`${s.rows.reduce(((e,t)=>e+(f(t[r])?1:0)),0)}/${e}\` |`}a.analysisMarkdownOutput.textContent=t,l("Table analyzed!")},getColumnStats(e){if(e>=s.headers.length)return null;const t=s.rows.map((t=>t[e]||"")),r=[...new Set(t)],n=t.filter((e=>!e.trim())).length;return{columnName:s.headers[e],totalCells:t.length,uniqueValues:r.length,emptyCells:n,mostCommon:this.getMostCommonValue(t)}},getMostCommonValue(e){const t={};return e.forEach((e=>{t[e]=(t[e]||0)+1})),Object.entries(t).sort((([,e],[,t])=>t-e))[0]?.[0]||""}},w={generate(){if(!s.isValid())return void(a.outputTextArea.value="");const e=u[s.outputFormat];a.outputTextArea.value=e?e():u[t.MARKDOWN]()},setFormat(e){Object.values(t).includes(e)&&(s.outputFormat=e,this.generate())}};({init(){c.init(),this.bindEvents(),this.initializeKeyboardShortcuts()},parseTable(){const e=a.inputTextArea?.value?.trim();if(e)try{const t=h.parse(e);s.saveToHistory(),Object.assign(s,t),m.render(),w.generate(),l("Table parsed successfully!")}catch(e){l(`Error parsing table: ${e.message}`,o.ERROR)}else l("Please enter a table to parse",o.ERROR)},async copyToClipboard(){const e=await(async e=>{try{return await navigator.clipboard.writeText(e),!0}catch(t){const r=document.createElement("textarea");r.value=e,r.style.position="fixed",r.style.opacity="0",document.body.appendChild(r),r.select();const n=document.execCommand("copy");return document.body.removeChild(r),n}})(a.outputTextArea.value);l(e?"Copied to clipboard!":"Failed to copy to clipboard",e?o.SUCCESS:o.ERROR)},clearAll(){(a.inputTextArea?.value?.trim()||!s.isEmpty()||a.outputTextArea?.value?.trim())&&!confirm("Are you sure you want to clear everything?")||(a.inputTextArea&&(a.inputTextArea.value=""),a.outputTextArea&&(a.outputTextArea.value=""),a.tableContainer&&(a.tableContainer.innerHTML=""),a.analysisMarkdownOutput&&(a.analysisMarkdownOutput.textContent=""),s.reset(),l("All cleared"))},toggleReorderMode(){s.isEmpty()?l("Please create a table first",o.ERROR):(s.isReorderMode=!s.isReorderMode,a.reorderBtn&&(a.reorderBtn.textContent=s.isReorderMode?"Edit Table":"Re-order",a.reorderBtn.classList.toggle("btn-secondary",s.isReorderMode)),m.render(),l(s.isReorderMode?"Reorder mode enabled":"Edit mode enabled",o.INFO))},undo(){s.undo()?(m.render(),l("Undone",o.INFO)):l("Nothing to undo",o.WARNING)},redo(){s.redo()?(m.render(),l("Redone",o.INFO)):l("Nothing to redo",o.WARNING)},bindEvents(){a.themeToggle?.addEventListener("click",(()=>c.toggle())),a.parseBtn?.addEventListener("click",(()=>this.parseTable())),a.analyzeBtn?.addEventListener("click",(()=>{y.analyze(),a.analysisSection&&(a.analysisSection.open=!0)})),a.copyBtn?.addEventListener("click",(()=>this.copyToClipboard())),a.clearBtn?.addEventListener("click",(()=>this.clearAll())),a.addColumnBtn?.addEventListener("click",(()=>p.addColumn())),a.addRowBtn?.addEventListener("click",(()=>p.addRow())),a.sortRowsBtn?.addEventListener("click",(()=>p.sortRows())),a.removeColumnBtn?.addEventListener("click",(()=>p.removeColumn())),a.removeRowBtn?.addEventListener("click",(()=>p.removeRow())),a.reorderBtn?.addEventListener("click",(()=>this.toggleReorderMode())),a.inputTextArea?.addEventListener("input",d((()=>this.parseTable()),300)),a.outputFormat?.addEventListener("change",(e=>{w.setFormat(e.target.value)})),document.addEventListener("change",(e=>{"outputFormat"===e.target?.id&&w.setFormat(e.target.value)})),window.addEventListener("DOMContentLoaded",(()=>c.init())),window.addEventListener("beforeunload",(e=>{s.isEmpty()||(e.preventDefault(),e.returnValue="")}))},initializeKeyboardShortcuts(){document.addEventListener("keydown",(e=>{!e.ctrlKey&&!e.metaKey||"z"!==e.key||e.shiftKey||(e.preventDefault(),this.undo()),(e.ctrlKey||e.metaKey)&&("z"===e.key&&e.shiftKey||"y"===e.key)&&(e.preventDefault(),this.redo()),(e.ctrlKey||e.metaKey)&&"Enter"===e.key&&(e.preventDefault(),this.parseTable()),(e.ctrlKey||e.metaKey)&&e.shiftKey&&"C"===e.key&&(e.preventDefault(),this.copyToClipboard())}))}}).init()})();