(()=>{"use strict";const e=Object.freeze({DARK:"dark",LIGHT:"light"}),t=Object.freeze({MARKDOWN:"markdown",GENERIC_JSON:"generic_json",SERVICE_PROVIDER_JSON:"service_provider_json",HTML:"html"}),r=Object.freeze({CENTER:"center",RIGHT:"right",LEFT:"left"}),n=Object.freeze({[r.CENTER]:":---:",[r.RIGHT]:"---:",[r.LEFT]:":---"}),a=Object.freeze({SUCCESS:"success",ERROR:"error",WARNING:"warning",INFO:"info"}),o={themeToggle:document.getElementById("themeToggle"),get sunPath(){return this.themeToggle?.querySelector(".sun")},get moonPath(){return this.themeToggle?.querySelector(".moon")},inputTextArea:document.getElementById("input"),outputTextArea:document.getElementById("output"),tableContainer:document.getElementById("tableContainer"),analysisMarkdownOutput:document.getElementById("analysisMarkdownOutput"),parseBtn:document.getElementById("parseBtn"),analyzeBtn:document.getElementById("analyzeBtn"),copyOutputBtn:document.getElementById("copyOutputBtn"),clearBtn:document.getElementById("clearBtn"),addColumnBtn:document.getElementById("addColumnBtn"),addRowBtn:document.getElementById("addRowBtn"),sortRowsBtn:document.getElementById("sortRowsBtn"),removeColumnBtn:document.getElementById("removeColumnBtn"),removeRowBtn:document.getElementById("removeRowBtn"),reorderBtn:document.getElementById("reorderBtn"),notificationDiv:document.getElementById("notification"),outputFormatSelect:document.getElementById("outputFormat"),newProviderNameInput:document.getElementById("newProviderName"),supportedServicesInput:document.getElementById("supportedServices"),addProviderBtn:document.getElementById("addProviderBtn"),analysisDetails:document.getElementById("analysisDetails"),advancedOpsDetails:document.getElementById("advancedOpsDetails")};const s=new class{constructor(){this.headers=[],this.rows=[],this.alignments=[],this.isReorderMode=!1,this.outputFormat=t.MARKDOWN,this.history=[],this.historyIndex=-1}saveToHistory(){const e={headers:JSON.parse(JSON.stringify(this.headers)),rows:JSON.parse(JSON.stringify(this.rows)),alignments:JSON.parse(JSON.stringify(this.alignments))};this.history=this.history.slice(0,this.historyIndex+1),this.history.push(e),this.historyIndex++,this.history.length>50&&(this.history.shift(),this.historyIndex--)}undo(){if(this.historyIndex>0){this.historyIndex--;const e=this.history[this.historyIndex];return this.headers=JSON.parse(JSON.stringify(e.headers)),this.rows=JSON.parse(JSON.stringify(e.rows)),this.alignments=JSON.parse(JSON.stringify(e.alignments)),!0}return!1}redo(){if(this.historyIndex<this.history.length-1){this.historyIndex++;const e=this.history[this.historyIndex];return this.headers=JSON.parse(JSON.stringify(e.headers)),this.rows=JSON.parse(JSON.stringify(e.rows)),this.alignments=JSON.parse(JSON.stringify(e.alignments)),!0}return!1}reset(){this.headers=[],this.rows=[],this.alignments=[],this.isReorderMode=!1,this.history=[],this.historyIndex=-1}isEmpty(){return 0===this.headers.length&&0===this.rows.length}isValid(){return this.headers.length>0&&this.alignments.length===this.headers.length}},i=e=>{if("string"!=typeof e)return"";const t=document.createElement("div");return t.textContent=e,t.innerHTML.replace(/"/g,"&quot;").replace(/'/g,"&#39;")},d=(e,t)=>{let r;return(...n)=>{clearTimeout(r),r=setTimeout((()=>e.apply(null,n)),t)}},l=async e=>{try{return await navigator.clipboard.writeText(e),!0}catch(t){const r=document.createElement("textarea");r.value=e,r.style.position="fixed",r.style.opacity="0",r.style.left="-9999px",document.body.appendChild(r),r.select();try{const e=document.execCommand("copy");return document.body.removeChild(r),e}catch(e){return document.body.removeChild(r),!1}}},c=e=>e.toLowerCase().trim().replace(/\s+/g,""),u=e=>e.replace(/\b\w/g,(e=>e.toUpperCase())).replace(/([a-z])([A-Z0-9])/g,"$1 $2").replace(/\b\w/g,(e=>e.toUpperCase())).replace(/\s+/g,""),m=(e,t=a.SUCCESS,r=3e3)=>{o.notificationDiv&&(o.notificationDiv.textContent=e,o.notificationDiv.className="notification show",o.notificationDiv.classList.add(t),o.notificationDiv.style.opacity="1",o.notificationDiv.style.bottom="30px",setTimeout((()=>{o.notificationDiv.style.opacity="0",o.notificationDiv.style.bottom="20px",setTimeout((()=>{"0"===o.notificationDiv.style.opacity&&o.notificationDiv.classList.remove("show",t)}),300)}),r))},h={toggle:()=>{const t=document.documentElement.getAttribute("data-theme")===e.DARK?e.LIGHT:e.DARK;h.set(t)},set:e=>{document.documentElement.setAttribute("data-theme",e),localStorage.setItem("theme",e),h.updateIcons(e)},updateIcons:t=>{o.sunPath&&o.moonPath&&(o.sunPath.style.display=t===e.DARK?"block":"none",o.moonPath.style.display=t===e.DARK?"none":"block")},init:()=>{const t=localStorage.getItem("theme")||(window.matchMedia("(prefers-color-scheme: dark)").matches?e.DARK:e.LIGHT);h.set(t)}},p={parse:e=>{if(!e?.trim())throw new Error("Input is empty.");const t=e.trim().split("\n").map((e=>e.trim())).filter((e=>e));if(t.length<1)throw new Error("Table must have at least a header row.");const n=t.findIndex((e=>e.includes("|")));if(-1===n)throw new Error("No valid header row found.");const a=p.parseRow(t[n]);let o,s=n+1;if(s<t.length){const e=t[s];if(e&&e.match(/^\|?\s*:?-+:?\s*(\|\s*:?-+:?\s*)*\|?\s*$/)){const t=p.parseRow(e);t.length===a.length&&(o=t.map((e=>{const t=e.trim();return t.startsWith(":")&&t.endsWith(":")?r.CENTER:t.endsWith(":")?r.RIGHT:r.LEFT})),s++)}}o&&o.length===a.length||(o=a.map((()=>r.LEFT)));const d=t.slice(s).filter((e=>!e.match(/^\|?\s*:?-+:?\s*(\|\s*:?-+:?\s*)*\|?\s*$/))).map((e=>{const t=p.parseRow(e);for(;t.length<a.length;)t.push("");return t.length>a.length&&t.splice(a.length),t}));return{headers:a.map((e=>i(e.replace(/\*\*/g,"")))),alignments:o,rows:d.map((e=>e.map((e=>i(e.replace(/\*\*/g,""))))))}},parseRow:e=>{const t=e.split("|").map((e=>e.trim()));let r=0,n=t.length;return""===t[0]&&(r=1),""===t[t.length-1]&&(n=t.length-1),t.slice(r,n)}},g=(e,t)=>{if(!e||0===e.length||!t)throw new Error("Invalid table data for Service/Provider JSON conversion.");const r={},n=(e[0],e.slice(1));return t.forEach((e=>{const t=e[0]?.trim();t&&(r[t]={},n.forEach(((n,a)=>{r[t][n]="yes"===e[a+1]?.toLowerCase()?"yes":"no"})))})),r},y=e=>{if(0===Object.keys(e).length)return{headers:[],rows:[],alignments:[]};const t=Object.keys(e),n=new Set;t.forEach((t=>{e[t]&&Object.keys(e[t]).forEach((e=>n.add(e)))}));const a=Array.from(n).sort(),o=["Service Name",...a],s=o.map((()=>r.LEFT));return{headers:o,rows:t.sort().map((t=>{const r=[t];return a.forEach((n=>{r.push("yes"===e[t]?.[n]?.toLowerCase()?"Yes":"No")})),r})),alignments:s}},v=(e,t,r)=>{if(!t||!r)throw new Error("New provider name and supported services are required.");let n=JSON.parse(JSON.stringify(e));const a=u(t.trim()),o=r.split(",").map((e=>c(e.trim()))).filter(Boolean),s={};Object.keys(n).forEach((e=>{const t=c(e);s[t]={...n[e]},s[t][a]="no"})),o.forEach((e=>{if(s[e])s[e][a]="yes";else{s[e]={};const t=Object.keys(n)[0];t&&n[t]&&Object.keys(n[t]).forEach((t=>{s[e][t]="no"})),s[e][a]="yes"}}));const i={};return Object.keys(s).sort().forEach((e=>{const t=u(e);i[t]={};Object.keys(s[e]).sort().forEach((r=>{i[t][r]=s[e][r]}))})),i},f={[t.MARKDOWN]:()=>{if(!s.isValid())return"";const e=`| ${s.alignments.map((e=>n[e]||n[r.LEFT])).join(" | ")} |`;return[`| ${s.headers.join(" | ")} |`,e,s.rows.map((e=>`| ${e.join(" | ")} |`)).join("\n")].filter(Boolean).join("\n")},[t.GENERIC_JSON]:()=>{if(!s.isValid())return JSON.stringify({},null,2);const e=s.rows.map((e=>{const t={};return s.headers.forEach(((r,n)=>{t[r]=e[n]})),t}));return JSON.stringify(e,null,2)},[t.SERVICE_PROVIDER_JSON]:()=>{if(!s.isValid())return JSON.stringify({},null,2);try{const e=g(s.headers,s.rows);return JSON.stringify(e,null,2)}catch(e){return m(`Error converting to Service/Provider JSON: ${e.message}`,a.ERROR),JSON.stringify({error:e.message},null,2)}},[t.HTML]:()=>{if(!s.isValid())return"";const e=e=>e!==r.LEFT?` style="text-align: ${e};"`:"";return`<table>\n<thead>\n<tr>${s.headers.map(((t,r)=>`<th${e(s.alignments[r])}>${i(t)}</th>`)).join("")}</tr>\n</thead>\n<tbody>\n${s.rows.map((t=>`<tr>${t.map(((t,r)=>`<td${e(s.alignments[r])}>${i(t)}</td>`)).join("")}</tr>`)).join("")}\n</tbody>\n</table>`}},E={render:()=>{if(s.isEmpty())return o.tableContainer.innerHTML='<p class="empty-table-message">Paste a Markdown table above or use "Add Row/Column" to start.</p>',void b.generate();if(!s.isValid())return o.tableContainer.innerHTML='<p class="empty-table-message error-message">Table data is invalid. Ensure headers and alignments match.</p>',void b.generate();try{const e=document.createElement("table");e.appendChild(E.createHeader()),e.appendChild(E.createBody()),o.tableContainer.innerHTML="",o.tableContainer.appendChild(e),b.generate()}catch(e){o.tableContainer.innerHTML='<p class="empty-table-message error-message">Error rendering table. Please check your data.</p>'}},createHeader:()=>{const e=document.createElement("thead"),t=document.createElement("tr");return s.headers.forEach(((e,r)=>{const n=document.createElement("th");n.textContent=e,n.draggable=s.isReorderMode,n.dataset.index=r,n.classList.toggle("dragging-allowed",s.isReorderMode),n.contentEditable=!s.isReorderMode,n.tabIndex=s.isReorderMode?-1:0,s.isReorderMode&&(n.addEventListener("dragstart",w.handleDragStart),n.addEventListener("dragover",w.handleDragOver),n.addEventListener("drop",w.handleDrop)),n.addEventListener("blur",(()=>{if(!s.isReorderMode){const e=i(n.textContent);s.headers[r]!==e&&(s.saveToHistory(),s.headers[r]=e,b.generate())}})),n.addEventListener("keydown",(e=>{"Enter"!==e.key||s.isReorderMode||(e.preventDefault(),n.blur())})),t.appendChild(n)})),e.appendChild(t),e},createBody:()=>{const e=document.createElement("tbody");return s.rows.forEach(((t,r)=>{const n=document.createElement("tr");n.draggable=s.isReorderMode,n.dataset.index=r,n.classList.toggle("dragging-allowed",s.isReorderMode),s.isReorderMode&&(n.addEventListener("dragstart",w.handleDragStart),n.addEventListener("dragover",w.handleDragOver),n.addEventListener("drop",w.handleDrop)),t.forEach(((e,t)=>{const a=document.createElement("td");a.textContent=e,a.contentEditable=!s.isReorderMode,a.tabIndex=s.isReorderMode?-1:0,a.addEventListener("blur",(()=>{if(!s.isReorderMode){const e=i(a.textContent);s.rows[r][t]!==e&&(s.saveToHistory(),s.rows[r][t]=e,b.generate())}})),a.addEventListener("keydown",(e=>{"Enter"!==e.key||s.isReorderMode||(e.preventDefault(),a.blur())})),n.appendChild(a)})),e.appendChild(n)})),e}},w={currentDraggedElement:null,handleDragStart:e=>{w.currentDraggedElement=e.target,e.target.classList.add("dragging"),e.dataTransfer.setData("text/plain",e.target.dataset.index),e.dataTransfer.setData("type",e.target.tagName.toLowerCase()),e.dataTransfer.effectAllowed="move"},handleDragOver:e=>{e.preventDefault(),e.dataTransfer.dropEffect="move";const t=e.target.closest("tr, th");if(!t||t===w.currentDraggedElement)return;const r=e.dataTransfer.getData("type");if("tr"===r&&"TR"===t.tagName){const r=t.parentNode,n=w.getDragAfterElement(r,e.clientY,"tr");w.currentDraggedElement&&(null==n?r.appendChild(w.currentDraggedElement):r.insertBefore(w.currentDraggedElement,n))}else"th"===r&&t.tagName},handleDrop:e=>{if(e.preventDefault(),!w.currentDraggedElement)return;w.currentDraggedElement.classList.remove("dragging");const t=parseInt(e.dataTransfer.getData("text/plain")),r=e.dataTransfer.getData("type");let n=e.target.closest("tr, th");if(!n)return w.currentDraggedElement=null,void E.render();const a=parseInt(n.dataset.index);if(t!==a){if(s.saveToHistory(),"th"===r)R.reorderColumns(t,a);else if("tr"===r){const e=w.currentDraggedElement.parentNode,r=Array.from(e.children).indexOf(w.currentDraggedElement);R.reorderRows(t,r)}E.render(),O.analyzeIfOpen()}w.currentDraggedElement=null},getDragAfterElement:(e,t,r)=>[...e.querySelectorAll(`${r}:not(.dragging)`)].reduce(((e,r)=>{const n=r.getBoundingClientRect(),a=t-n.top-n.height/2;return a<0&&a>e.offset?{offset:a,element:r}:e}),{offset:Number.NEGATIVE_INFINITY}).element},R={addColumn:()=>{if(s.isReorderMode)return;s.saveToHistory();const e=`Column ${s.headers.length+1}`;s.headers.push(e),s.alignments.push(r.LEFT),s.rows.forEach((e=>e.push(""))),E.render(),m("Column added")},addRow:()=>{if(s.isReorderMode)return;s.saveToHistory();const e=Array(s.headers.length).fill("");s.rows.push(e),E.render(),m("Row added")},removeColumn:()=>{if(s.isReorderMode)return;if(s.headers.length<=1)return void m("Cannot remove the last column",a.WARNING);s.saveToHistory();const e=s.headers.length-1;s.headers.splice(e,1),s.alignments.splice(e,1),s.rows.forEach((t=>t.splice(e,1))),E.render(),O.analyzeIfOpen(),m("Last column removed")},removeRow:()=>{s.isReorderMode||(0!==s.rows.length?(s.saveToHistory(),s.rows.pop(),E.render(),O.analyzeIfOpen(),m("Last row removed")):m("No rows to remove",a.WARNING))},sortRows:()=>{s.isReorderMode||(s.rows.length?(s.saveToHistory(),s.rows.sort(((e,t)=>(e[0]?.toLowerCase()||"").localeCompare(t[0]?.toLowerCase()||""))),E.render(),m("Rows sorted by first column")):m("No rows to sort",a.WARNING))},reorderColumns:(e,t)=>{const r=r=>{const n=r.splice(e,1)[0];r.splice(t,0,n)};r(s.headers),r(s.alignments),s.rows.forEach((e=>r(e)))},reorderRows:(e,t)=>{const r=s.rows.splice(e,1)[0];s.rows.splice(t,0,r)},addProviderAndUpdateTable:()=>{if(s.isReorderMode)return;const e=o.newProviderNameInput.value.trim(),t=o.supportedServicesInput.value.trim();if(!e)return m("New Provider Name is required.",a.ERROR),void o.newProviderNameInput.focus();if(!t)return m("Supported Services list is required.",a.ERROR),void o.supportedServicesInput.focus();if(0!==s.headers.length)try{s.saveToHistory();const r=g(s.headers,s.rows),n=v(r,e,t),{headers:i,rows:d,alignments:l}=y(n);s.headers=i,s.rows=d,s.alignments=l,E.render(),O.analyzeIfOpen(),m(`Provider "${e}" added/updated.`,a.SUCCESS),o.newProviderNameInput.value="",o.supportedServicesInput.value=""}catch(e){m(`Error: ${e.message}`,a.ERROR,5e3),s.historyIndex>0&&0===s.history[s.historyIndex].headers.length&&(s.history.pop(),s.historyIndex--)}else m("Cannot add provider to an empty table. Parse or create a table first.",a.ERROR)}},b={generate:()=>{if(s.isEmpty())return void(o.outputTextArea.value="");if(!s.isValid())return void(o.outputTextArea.value="Table data is currently invalid. Cannot generate output.");const e=f[s.outputFormat];o.outputTextArea.value=e?e():f[t.MARKDOWN]()},setFormat:e=>{Object.values(t).includes(e)&&(s.outputFormat=e,b.generate())}},O={analyze:()=>{if(0===s.rows.length||0===s.headers.length)return void(o.analysisMarkdownOutput.textContent="No data to analyze. Table is empty.");if(!s.isValid())return void(o.analysisMarkdownOutput.textContent="Table structure is invalid. Cannot analyze.");const e=s.rows.length;let t="| ";t+=`**Total** = \`${e}\` | `;const r=s.headers.slice(1),n=[];r.forEach(((t,r)=>{const a=r+1,o=s.rows.reduce(((e,t)=>e+("yes"===t[a]?.trim().toLowerCase()?1:0)),0);n.push(`\`${o}/${e}\``)})),t+=n.join(" | ")+" |",o.analysisMarkdownOutput.textContent=t,m("Table analyzed!",a.INFO)},analyzeIfOpen:()=>{o.analysisDetails&&o.analysisDetails.open&&O.analyze()}},I={init:()=>{"loading"===document.readyState?document.addEventListener("DOMContentLoaded",(()=>{h.init(),I.bindEvents(),I.initializeKeyboardShortcuts(),E.render(),o.outputFormatSelect?.value&&b.setFormat(o.outputFormatSelect.value)})):(h.init(),I.bindEvents(),I.initializeKeyboardShortcuts(),E.render(),o.outputFormatSelect?.value&&b.setFormat(o.outputFormatSelect.value))},parseTable:()=>{const e=o.inputTextArea.value.trim();if(e)try{const t=p.parse(e);s.saveToHistory(),Object.assign(s,t),E.render(),O.analyzeIfOpen(),m("Table parsed successfully!")}catch(e){m(`Error parsing table: ${e.message}`,a.ERROR,5e3)}else m("Input is empty. Nothing to parse.",a.WARNING)},copyOutputToClipboard:async()=>{if(!o.outputTextArea.value)return void m("Nothing to copy from output.",a.WARNING);const e=await l(o.outputTextArea.value);m(e?"Output copied to clipboard!":"Failed to copy output.",e?a.SUCCESS:a.ERROR)},clearAll:()=>{confirm("Are you sure you want to clear all input, table data, and output?")&&(s.saveToHistory(),o.inputTextArea.value="",o.outputTextArea.value="",o.analysisMarkdownOutput.textContent="Analysis results will appear here.",s.reset(),E.render(),b.generate(),m("All cleared. You can undo this action."))},toggleReorderMode:()=>{s.isReorderMode=!s.isReorderMode,o.reorderBtn.innerHTML=`<span class="icon">${s.isReorderMode?"✏️":"✥"}</span> ${s.isReorderMode?"Edit Mode":"Re-order"}`,o.reorderBtn.setAttribute("aria-label",s.isReorderMode?"Switch to edit mode":"Switch to reorder mode"),E.render()},undo:()=>{s.undo()?(E.render(),O.analyzeIfOpen(),m("Action undone.",a.INFO)):m("Nothing to undo.",a.WARNING)},redo:()=>{s.redo()?(E.render(),O.analyzeIfOpen(),m("Action redone.",a.INFO)):m("Nothing to redo.",a.WARNING)},bindEvents:()=>{o.themeToggle?.addEventListener("click",h.toggle),o.parseBtn?.addEventListener("click",I.parseTable),o.analyzeBtn?.addEventListener("click",O.analyze),o.copyOutputBtn?.addEventListener("click",I.copyOutputToClipboard),o.clearBtn?.addEventListener("click",I.clearAll),o.addColumnBtn?.addEventListener("click",R.addColumn),o.addRowBtn?.addEventListener("click",R.addRow),o.sortRowsBtn?.addEventListener("click",R.sortRows),o.removeColumnBtn?.addEventListener("click",R.removeColumn),o.removeRowBtn?.addEventListener("click",R.removeRow),o.reorderBtn?.addEventListener("click",I.toggleReorderMode),o.addProviderBtn?.addEventListener("click",R.addProviderAndUpdateTable),o.inputTextArea&&o.inputTextArea.addEventListener("input",d((()=>{""===o.inputTextArea.value.trim()?(s.reset(),E.render(),O.analyzeIfOpen(),b.generate()):I.parseTable()}),500)),o.outputFormatSelect?.addEventListener("change",(e=>b.setFormat(e.target.value))),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",h.init):h.init(),window.addEventListener("beforeunload",(e=>{s.isEmpty()||(e.preventDefault(),e.returnValue="You have unsaved changes. Are you sure you want to leave?")})),[o.advancedOpsDetails,o.analysisDetails].forEach((e=>{e&&e.addEventListener("toggle",(()=>{"analysisDetails"===e.id&&e.open&&O.analyze()}))}))},initializeKeyboardShortcuts:()=>{document.addEventListener("keydown",(e=>{const t=e.target.closest('textarea, input, [contenteditable="true"]');if(t){if((e.ctrlKey||e.metaKey)&&"Enter"===e.key&&"TEXTAREA"!==e.target.tagName)return void e.target.blur();if("Escape"===e.key&&e.target.hasAttribute("contenteditable"))return void e.target.blur();if(!e.target.hasAttribute("contenteditable"))return}!e.ctrlKey&&!e.metaKey||"z"!==e.key.toLowerCase()||e.shiftKey?(e.ctrlKey||e.metaKey)&&("y"===e.key.toLowerCase()||"z"===e.key.toLowerCase()&&e.shiftKey)?(e.preventDefault(),I.redo()):!e.ctrlKey&&!e.metaKey||"Enter"!==e.key||t?(e.ctrlKey||e.metaKey)&&e.shiftKey&&"C"===e.key.toUpperCase()&&(e.preventDefault(),I.copyOutputToClipboard()):(e.preventDefault(),I.parseTable()):(e.preventDefault(),I.undo())}))}};I.init()})();