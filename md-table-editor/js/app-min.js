(()=>{"use strict";const e=Object.freeze({DARK:"dark",LIGHT:"light"}),t=Object.freeze({MARKDOWN:"markdown",GENERIC_JSON:"generic_json",SERVICE_PROVIDER_JSON:"service_provider_json",HTML:"html"}),r=Object.freeze({CENTER:"center",RIGHT:"right",LEFT:"left"}),n=Object.freeze({[r.CENTER]:":---:",[r.RIGHT]:"---:",[r.LEFT]:":---"}),a=Object.freeze({SUCCESS:"success",ERROR:"error",WARNING:"warning",INFO:"info"}),o=(new Proxy({},{get:(e,t)=>(t in e||(e[t]=document.getElementById(t)||document.querySelector(`[data-element="${t}"]`)||document.querySelector(`.${t}`)),e[t])}),{themeToggle:document.getElementById("themeToggle"),get sunPath(){return this.themeToggle?.querySelector(".sun")},get moonPath(){return this.themeToggle?.querySelector(".moon")},input:document.getElementById("input"),output:document.getElementById("output"),tableContainer:document.getElementById("tableContainer"),analysisMarkdownOutput:document.getElementById("analysisMarkdownOutput"),parseBtn:document.getElementById("parseBtn"),analyzeBtn:document.getElementById("analyzeBtn"),copyOutputBtn:document.getElementById("copyOutputBtn"),clearBtn:document.getElementById("clearBtn"),addColumnBtn:document.getElementById("addColumnBtn"),addRowBtn:document.getElementById("addRowBtn"),sortRowsBtn:document.getElementById("sortRowsBtn"),removeColumnBtn:document.getElementById("removeColumnBtn"),removeRowBtn:document.getElementById("removeRowBtn"),reorderBtn:document.getElementById("reorderBtn"),notification:document.getElementById("notification"),outputFormat:document.getElementById("outputFormat"),newProviderName:document.getElementById("newProviderName"),supportedServices:document.getElementById("supportedServices"),addProviderBtn:document.getElementById("addProviderBtn"),analysisDetails:document.getElementById("analysisDetails"),advancedOpsDetails:document.getElementById("advancedOpsDetails"),outputStats:document.getElementById("outputStats"),loadingIndicator:document.getElementById("loadingIndicator")});const s=e=>{if("string"!=typeof e)return"";const t=document.createElement("div");return t.textContent=e,t.innerHTML.replace(/"/g,"&quot;").replace(/'/g,"&#39;")},i=(e,t)=>{let r;return(...n)=>{clearTimeout(r),r=setTimeout((()=>e.apply(null,n)),t)}},d=async e=>{try{return await navigator.clipboard.writeText(e),!0}catch(t){const r=document.createElement("textarea");r.value=e,r.style.position="fixed",r.style.opacity="0",r.style.left="-9999px",document.body.appendChild(r),r.select();try{const e=document.execCommand("copy");return document.body.removeChild(r),e}catch(e){return document.body.removeChild(r),!1}}},l=e=>e.toLowerCase().trim().replace(/\s+/g,""),c=e=>e.replace(/\b\w/g,(e=>e.toUpperCase())).replace(/([a-z])([A-Z0-9])/g,"$1 $2").replace(/\b\w/g,(e=>e.toUpperCase())).replace(/\s+/g,""),u=(e=!0)=>{o.loadingIndicator&&(o.loadingIndicator.style.display=e?"flex":"none",o.loadingIndicator.setAttribute("aria-hidden",!e))},m=e=>{if(0===e)return"0 Bytes";const t=Math.floor(Math.log(e)/Math.log(1024));return Math.round(e/Math.pow(1024,t)*100)/100+" "+["Bytes","KB","MB","GB"][t]},h={show:(e,t=a.SUCCESS,r=4e3)=>{if(!o.notification)return;h.hide();const n=o.notification;n.innerHTML="",n.className="notification",n.textContent=e,n.classList.add("show",t),n.setAttribute("aria-live",t===a.ERROR?"assertive":"polite"),r>0&&setTimeout((()=>h.hide()),r)},hide:()=>{if(!o.notification)return;const e=o.notification;e.classList.remove("show",...Object.values(a)),e.innerHTML=""},success:(e,t=4e3)=>h.show(e,a.SUCCESS,t),error:(e,t=6e3)=>h.show(e,a.ERROR,t),warning:(e,t=5e3)=>h.show(e,a.WARNING,t),info:(e,t=4e3)=>h.show(e,a.INFO,t)},p={init:()=>{const t=localStorage.getItem("theme"),r=window.matchMedia("(prefers-color-scheme: dark)").matches,n=t||(r?e.DARK:e.LIGHT);p.set(n),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",(t=>{localStorage.getItem("theme")||p.set(t.matches?e.DARK:e.LIGHT)}))},toggle:()=>{const t=document.documentElement.getAttribute("data-theme")===e.DARK?e.LIGHT:e.DARK;p.set(t)},set:t=>{document.documentElement.setAttribute("data-theme",t),localStorage.setItem("theme",t),p.updateIcons(t);const r=document.querySelector('meta[name="theme-color"]');r&&(r.content=t===e.DARK?"#0d1117":"#0969da")},updateIcons:t=>{o.sunPath&&o.moonPath&&(o.sunPath.style.display=t===e.DARK?"block":"none",o.moonPath.style.display=t===e.DARK?"none":"block")}},g={parse:e=>{if(!e?.trim())throw new Error("Input is empty or contains only whitespace.");const t=e.trim().split("\n").map((e=>e.trim())).filter((e=>e));if(t.length<1)throw new Error("No valid content found in input.");const n=t.findIndex((e=>e.includes("|")&&!e.match(/^\|?\s*:?-+:?/)));if(-1===n)throw new Error("No valid table header found. Make sure your table uses pipe (|) separators.");const a=g.parseRow(t[n]);let o,i=n+1;if(i<t.length){const e=t[i];if(e&&e.match(/^\|?\s*:?-+:?\s*(\|\s*:?-+:?\s*)*\|?\s*$/)){const t=g.parseRow(e);t.length===a.length&&(o=t.map((e=>{const t=e.trim();return t.startsWith(":")&&t.endsWith(":")?r.CENTER:t.endsWith(":")?r.RIGHT:r.LEFT})),i++)}}o&&o.length===a.length||(o=a.map((()=>r.LEFT)));const d=t.slice(i).filter((e=>!e.match(/^\|?\s*:?-+:?\s*(\|\s*:?-+:?\s*)*\|?\s*$/))).map((e=>{const t=g.parseRow(e);for(;t.length<a.length;)t.push("");return t.length>a.length&&t.splice(a.length),t}));return{headers:a.map((e=>s(e.replace(/\*\*/g,"")))),alignments:o,rows:d.map((e=>e.map((e=>s(e.replace(/\*\*/g,""))))))}},parseRow:e=>{const t=e.split("|").map((e=>e.trim()));let r=0,n=t.length;return""===t[0]&&(r=1),""===t[t.length-1]&&(n=t.length-1),t.slice(r,n)}},y=(e,t)=>{if(!e||0===e.length||!t)throw new Error("Invalid table data for Service/Provider JSON conversion.");const r={},n=e.slice(1);return t.forEach((e=>{const t=e[0]?.trim();t&&(r[t]={},n.forEach(((n,a)=>{const o=e[a+1]?.toLowerCase().trim();r[t][n]="yes"===o?"yes":"no"})))})),r},v=e=>{if(0===Object.keys(e).length)return{headers:[],rows:[],alignments:[]};const t=Object.keys(e),n=new Set;t.forEach((t=>{e[t]&&Object.keys(e[t]).forEach((e=>n.add(e)))}));const a=Array.from(n).sort(),o=["Service Name",...a],s=o.map((()=>r.LEFT));return{headers:o,rows:t.sort().map((t=>{const r=[t];return a.forEach((n=>{const a=e[t]?.[n];r.push("yes"===a?"yes":"no")})),r})),alignments:s}},f=(e,t,r)=>{if(!t||!r)throw new Error("Provider name and supported services are required.");const n=structuredClone(e),a=c(t.trim()),o=r.split(",").map((e=>l(e.trim()))).filter(Boolean),s={};Object.keys(n).forEach((e=>{const t=l(e);s[t]={...n[e],[a]:"no"}})),o.forEach((e=>{if(s[e])s[e][a]="yes";else{c(e);s[e]={},Object.keys(n).forEach((t=>{Object.keys(n[t]).forEach((t=>{s[e][t]="no"}))})),s[e][a]="yes"}}));const i={};return Object.keys(s).sort().forEach((e=>{const t=c(e);i[t]={},Object.keys(s[e]).sort().forEach((r=>{i[t][r]=s[e][r]}))})),i},w={[t.MARKDOWN]:()=>{if(!T.isValid())return"";const e=`| ${T.alignments.map((e=>n[e]||n[r.LEFT])).join(" | ")} |`;return[`| ${T.headers.join(" | ")} |`,e,T.rows.map((e=>`| ${e.join(" | ")} |`)).join("\\n")].filter(Boolean).join("\\n")},[t.GENERIC_JSON]:()=>{if(!T.isValid())return JSON.stringify([],null,2);const e=T.rows.map((e=>{const t={};return T.headers.forEach(((r,n)=>{t[r]=e[n]||""})),t}));return JSON.stringify(e,null,2)},[t.SERVICE_PROVIDER_JSON]:()=>{if(!T.isValid())return JSON.stringify({},null,2);try{const e=y(T.headers,T.rows);return JSON.stringify(e,null,2)}catch(e){return h.error(`Error converting to Service/Provider JSON: ${e.message}`),JSON.stringify({error:e.message},null,2)}},[t.HTML]:()=>{if(!T.isValid())return"";const e=e=>e!==r.LEFT?` style="text-align: ${e};"`:"";return`<table>\n<thead>\n<tr>${T.headers.map(((t,r)=>`<th${e(T.alignments[r])}>${s(t)}</th>`)).join("")}</tr>\n</thead>\n<tbody>\n${T.rows.map((t=>`<tr>${t.map(((t,r)=>`<td${e(T.alignments[r])}>${s(t)}</td>`)).join("")}</tr>`)).join("\n")}\n</tbody>\n</table>`}},E={render:()=>{if(T.isEmpty())return o.tableContainer.innerHTML='\n                    <div class="empty-table-message">\n                        <p>üìã No table data available</p>\n                        <p>Paste a Markdown table above or use the "Add Row/Column" buttons to start creating your table.</p>\n                    </div>\n                ',void R.generate();if(!T.isValid())return o.tableContainer.innerHTML='\n                    <div class="empty-table-message error-message">\n                        <p>‚ö†Ô∏è Invalid table structure</p>\n                        <p>The table data is inconsistent. Please check that headers and alignments match.</p>\n                    </div>\n                ',void R.generate();try{const e=document.createElement("table");e.setAttribute("role","table"),e.setAttribute("aria-label","Editable data table");const t=E.createHeader(),r=E.createBody();e.appendChild(t),e.appendChild(r),o.tableContainer.innerHTML="",o.tableContainer.appendChild(e),R.generate(),T.updateStats()}catch(e){o.tableContainer.innerHTML=`\n                    <div class="empty-table-message error-message">\n                        <p>‚ùå Error rendering table</p>\n                        <p>Please check your data and try again. Error: ${e.message}</p>\n                    </div>\n                `}},createHeader:()=>{const e=document.createElement("thead"),t=document.createElement("tr");return t.setAttribute("role","row"),T.headers.forEach(((e,r)=>{const n=document.createElement("th");n.setAttribute("role","columnheader"),n.setAttribute("scope","col"),n.textContent=e,n.draggable=T.isReorderMode,n.dataset.index=r,n.classList.toggle("dragging-allowed",T.isReorderMode),n.contentEditable=!T.isReorderMode,n.tabIndex=T.isReorderMode?-1:0,T.isReorderMode?(n.addEventListener("dragstart",b.handleDragStart),n.addEventListener("dragover",b.handleDragOver),n.addEventListener("drop",b.handleDrop),n.setAttribute("aria-label",`Draggable column header: ${e}`)):n.setAttribute("aria-label",`Editable column header: ${e}`),n.addEventListener("blur",(e=>{const t=e.target.textContent.trim();t!==T.headers[r]&&(T.saveToHistory(),T.headers[r]=t,R.generate(),h.success("Header updated"))})),n.addEventListener("keydown",(e=>{"Enter"===e.key&&(e.preventDefault(),e.target.blur()),"Escape"===e.key&&(e.target.textContent=T.headers[r],e.target.blur())})),t.appendChild(n)})),e.appendChild(t),e},createBody:()=>{const e=document.createElement("tbody");return T.rows.forEach(((t,r)=>{const n=document.createElement("tr");n.setAttribute("role","row"),n.draggable=T.isReorderMode,n.dataset.index=r,n.classList.toggle("dragging-allowed",T.isReorderMode),T.isReorderMode&&(n.addEventListener("dragstart",b.handleDragStart),n.addEventListener("dragover",b.handleDragOver),n.addEventListener("drop",b.handleDrop),n.setAttribute("aria-label",`Draggable row ${r+1}`)),t.forEach(((t,a)=>{const o=document.createElement("td");o.setAttribute("role","gridcell"),o.textContent=t,o.contentEditable=!T.isReorderMode,o.tabIndex=T.isReorderMode?-1:0,T.isReorderMode||o.setAttribute("aria-label",`Editable cell: Row ${r+1}, Column ${a+1}`),o.addEventListener("blur",(e=>{const t=e.target.textContent.trim();t!==T.rows[r][a]&&(T.saveToHistory(),T.rows[r][a]=t,R.generate())})),o.addEventListener("keydown",(t=>{if("Enter"===t.key&&(t.preventDefault(),t.target.blur()),"Escape"===t.key&&(t.target.textContent=T.rows[r][a],t.target.blur()),"Tab"===t.key){t.preventDefault();const r=Array.from(e.querySelectorAll('td[contenteditable="true"]')),n=r.indexOf(t.target);let a;a=t.shiftKey?n>0?n-1:r.length-1:n<r.length-1?n+1:0,r[a]?.focus()}})),n.appendChild(o)})),e.appendChild(n)})),e}},b={currentDraggedElement:null,placeholder:null,handleDragStart:e=>{b.currentDraggedElement=e.target,e.target.classList.add("dragging"),e.dataTransfer.setData("text/plain",e.target.dataset.index),e.dataTransfer.setData("type",e.target.tagName.toLowerCase()),e.dataTransfer.effectAllowed="move",b.placeholder=e.target.cloneNode(!0),b.placeholder.classList.add("placeholder"),b.placeholder.style.opacity="0.5"},handleDragOver:e=>{e.preventDefault(),e.dataTransfer.dropEffect="move";const t=e.target.closest("tr, th");if(!t||t===b.currentDraggedElement)return;if("tr"===e.dataTransfer.getData("type")&&"TR"===t.tagName){const r=t.parentNode,n=b.getDragAfterElement(r,e.clientY,"tr");b.currentDraggedElement&&(n?r.insertBefore(b.currentDraggedElement,n):r.appendChild(b.currentDraggedElement))}},handleDrop:e=>{if(e.preventDefault(),!b.currentDraggedElement)return;b.currentDraggedElement.classList.remove("dragging");const t=parseInt(e.dataTransfer.getData("text/plain")),r=e.dataTransfer.getData("type");let n=e.target.closest("tr, th");if(!n)return b.currentDraggedElement=null,void E.render();const a=parseInt(n.dataset.index);t!==a&&(T.saveToHistory(),"th"===r?C.reorderColumns(t,a):"tr"===r&&C.reorderRows(t,a),E.render(),I.analyzeIfOpen(),h.success(("th"===r?"Column":"Row")+" reordered successfully")),b.currentDraggedElement=null},getDragAfterElement:(e,t,r)=>[...e.querySelectorAll(`${r}:not(.dragging)`)].reduce(((e,r)=>{const n=r.getBoundingClientRect(),a=t-n.top-n.height/2;return a<0&&a>e.offset?{offset:a,element:r}:e}),{offset:Number.NEGATIVE_INFINITY}).element},C={addColumn:()=>{if(T.isReorderMode)return;T.saveToHistory();const e=`Column ${T.headers.length+1}`;T.headers.push(e),T.alignments.push(r.LEFT),T.rows.forEach((e=>e.push(""))),E.render(),h.success("Column added successfully")},addRow:()=>{if(T.isReorderMode)return;T.saveToHistory();const e=Array(T.headers.length).fill("");T.rows.push(e),E.render(),h.success("Row added successfully")},removeColumn:()=>{if(T.isReorderMode)return;if(T.headers.length<=1)return void h.warning("Cannot remove the last column");T.saveToHistory();const e=T.headers.length-1;T.headers.splice(e,1),T.alignments.splice(e,1),T.rows.forEach((t=>t.splice(e,1))),E.render(),I.analyzeIfOpen(),h.success("Column removed successfully")},removeRow:()=>{T.isReorderMode||(0!==T.rows.length?(T.saveToHistory(),T.rows.pop(),E.render(),I.analyzeIfOpen(),h.success("Row removed successfully")):h.warning("No rows to remove"))},sortRows:()=>{T.isReorderMode||(0!==T.rows.length?(T.saveToHistory(),T.rows.sort(((e,t)=>{const r=(e[0]||"").toLowerCase(),n=(t[0]||"").toLowerCase();return r.localeCompare(n)})),E.render(),h.success("Rows sorted alphabetically")):h.warning("No rows to sort"))},reorderColumns:(e,t)=>{const r=r=>{const n=r.splice(e,1)[0];r.splice(t,0,n)};r(T.headers),r(T.alignments),T.rows.forEach((e=>r(e)))},reorderRows:(e,t)=>{const r=T.rows.splice(e,1)[0];T.rows.splice(t,0,r)},addProviderAndUpdateTable:()=>{if(T.isReorderMode)return;const e=o.newProviderName.value.trim(),t=o.supportedServices.value.trim();if(!e)return h.error("New Provider Name is required."),void o.newProviderName.focus();if(!t)return h.error("Supported Services list is required."),void o.supportedServices.focus();if(0!==T.headers.length)try{T.saveToHistory();const r=y(T.headers,T.rows),n=f(r,e,t),a=v(n);T.headers=a.headers,T.rows=a.rows,T.alignments=a.alignments,E.render(),I.analyzeIfOpen(),o.newProviderName.value="",o.supportedServices.value="",h.success(`Provider "${e}" added successfully with ${t.split(",").length} supported services`)}catch(e){h.error(`Error adding provider: ${e.message}`)}else h.error("Cannot add provider to an empty table. Parse or create a table first.")}},R={generate:()=>{if(T.isEmpty())return void(o.output.value="");if(!T.isValid())return void(o.output.value="Table data is currently invalid. Cannot generate output.");const e=w[T.outputFormat],r=e?e():w[t.MARKDOWN]();if(o.output.value=r,o.outputStats){const e=new Blob([r]).size,t=m(e);o.outputStats.textContent=`${T.stats.rows} rows √ó ${T.stats.columns} columns ‚Ä¢ ${t}`}},setFormat:e=>{Object.values(t).includes(e)&&(T.outputFormat=e,R.generate(),h.info(`Output format changed to ${e.replace("_"," ")}`))}},I={analyze:()=>{if(0===T.rows.length||0===T.headers.length)return void(o.analysisMarkdownOutput.textContent="No data to analyze. Table is empty.");if(!T.isValid())return void(o.analysisMarkdownOutput.textContent="Table structure is invalid. Cannot analyze.");const e=T.rows.length;let t=`| **Total** = \`${e}\` |`;for(let r=1;r<T.headers.length;r++){t+=` \`${T.rows.reduce(((e,t)=>e+("yes"===t[r]?.toLowerCase().trim()?1:0)),0)}/${e}\` |`}o.analysisMarkdownOutput.textContent=t,h.info("Table analysis complete!")},analyzeIfOpen:()=>{o.analysisDetails?.open&&I.analyze()}},T=new class{constructor(){this.headers=[],this.rows=[],this.alignments=[],this.isReorderMode=!1,this.outputFormat=t.MARKDOWN,this.history=[],this.historyIndex=-1,this.isModified=!1,this.lastSaveTime=Date.now(),this.stats={rows:0,columns:0,cells:0}}saveToHistory(){const e={headers:structuredClone(this.headers),rows:structuredClone(this.rows),alignments:structuredClone(this.alignments),timestamp:Date.now()};this.history=this.history.slice(0,this.historyIndex+1),this.history.push(e),this.historyIndex++,this.history.length>50&&(this.history.shift(),this.historyIndex--),this.isModified=!0,this.updateStats()}undo(){if(this.historyIndex>0){this.historyIndex--;const e=this.history[this.historyIndex];return this.restoreState(e),!0}return!1}redo(){if(this.historyIndex<this.history.length-1){this.historyIndex++;const e=this.history[this.historyIndex];return this.restoreState(e),!0}return!1}restoreState(e){this.headers=structuredClone(e.headers),this.rows=structuredClone(e.rows),this.alignments=structuredClone(e.alignments),this.updateStats()}updateStats(){this.stats={rows:this.rows.length,columns:this.headers.length,cells:this.rows.length*this.headers.length},this.updateStatsDisplay()}updateStatsDisplay(){if(o.outputStats){const{rows:e,columns:t,cells:r}=this.stats;o.outputStats.textContent=`${e} rows √ó ${t} columns = ${r} cells`}}reset(){this.headers=[],this.rows=[],this.alignments=[],this.isReorderMode=!1,this.history=[],this.historyIndex=-1,this.isModified=!1,this.updateStats()}isEmpty(){return 0===this.headers.length&&0===this.rows.length}isValid(){return this.headers.length>0&&this.alignments.length===this.headers.length}},S={init:()=>{"loading"===document.readyState?document.addEventListener("DOMContentLoaded",S.setup):S.setup()},setup:()=>{p.init(),S.bindEvents(),S.initializeKeyboardShortcuts(),S.initializeAccessibility(),E.render(),o.outputFormat?.value&&R.setFormat(o.outputFormat.value),S.initializeAutoSave(),h.success("Application loaded successfully",2e3)},parseTable:i((()=>{const e=o.input.value.trim();if(e){u(!0);try{const t=g.parse(e);T.saveToHistory(),T.headers=t.headers,T.alignments=t.alignments,T.rows=t.rows,E.render(),I.analyzeIfOpen(),h.success(`Table parsed successfully! ${t.rows.length} rows, ${t.headers.length} columns`)}catch(e){h.error(`Parse error: ${e.message}`)}finally{u(!1)}}else h.warning("Input is empty. Nothing to parse.")}),300),copyOutputToClipboard:async()=>{if(!o.output.value)return void h.warning("Nothing to copy from output.");const e=await d(o.output.value);h[e?"success":"error"](e?"Output copied to clipboard!":"Failed to copy output.")},clearAll:()=>{confirm("Are you sure you want to clear all input, table data, and output?")&&(T.saveToHistory(),o.input.value="",o.output.value="",o.analysisMarkdownOutput.textContent="Analysis results will appear here.",T.reset(),E.render(),R.generate(),h.success("All data cleared. You can undo this action."))},toggleReorderMode:()=>{T.isReorderMode=!T.isReorderMode;const e=o.reorderBtn,t=(e.querySelector(".icon svg"),e.querySelector("span:not(.icon)"));T.isReorderMode?(t.textContent="Edit Mode",e.setAttribute("aria-label","Switch to edit mode"),e.classList.add("btn-secondary"),h.info("Reorder mode enabled. Drag rows and columns to rearrange.")):(t.textContent="Re-order",e.setAttribute("aria-label","Switch to reorder mode"),e.classList.remove("btn-secondary"),h.info("Edit mode enabled. Click cells to edit content.")),E.render()},undo:()=>{T.undo()?(E.render(),I.analyzeIfOpen(),h.info("Action undone.")):h.warning("Nothing to undo.")},redo:()=>{T.redo()?(E.render(),I.analyzeIfOpen(),h.info("Action redone.")):h.warning("Nothing to redo.")},bindEvents:()=>{o.themeToggle?.addEventListener("click",p.toggle),o.parseBtn?.addEventListener("click",S.parseTable),o.analyzeBtn?.addEventListener("click",I.analyze),o.copyOutputBtn?.addEventListener("click",S.copyOutputToClipboard),o.clearBtn?.addEventListener("click",S.clearAll),o.addColumnBtn?.addEventListener("click",C.addColumn),o.addRowBtn?.addEventListener("click",C.addRow),o.sortRowsBtn?.addEventListener("click",C.sortRows),o.removeColumnBtn?.addEventListener("click",C.removeColumn),o.removeRowBtn?.addEventListener("click",C.removeRow),o.reorderBtn?.addEventListener("click",S.toggleReorderMode),o.addProviderBtn?.addEventListener("click",C.addProviderAndUpdateTable),o.input&&o.input.addEventListener("input",i((()=>{""===o.input.value.trim()?(T.reset(),E.render(),I.analyzeIfOpen(),R.generate()):S.parseTable()}),500)),o.outputFormat?.addEventListener("change",(e=>{R.setFormat(e.target.value)})),window.addEventListener("beforeunload",(e=>{T.isModified&&!T.isEmpty()&&(e.preventDefault(),e.returnValue="You have unsaved changes. Are you sure you want to leave?")})),[o.advancedOpsDetails,o.analysisDetails].forEach((e=>{e&&e.addEventListener("toggle",(e=>{e.target.querySelector("summary").setAttribute("aria-expanded",e.target.open),e.target.open&&"analysisDetails"===e.target.id&&I.analyze()}))}))},initializeKeyboardShortcuts:()=>{document.addEventListener("keydown",(e=>{const t=document.activeElement;t&&(t.closest('textarea, input, [contenteditable="true"]')||t.isContentEditable)?(e.ctrlKey||e.metaKey)&&e.shiftKey&&"C"===e.key.toUpperCase()&&(e.preventDefault(),S.copyOutputToClipboard()):!e.ctrlKey&&!e.metaKey||e.shiftKey||"z"!==e.key.toLowerCase()?(e.ctrlKey||e.metaKey)&&("y"===e.key.toLowerCase()||"z"===e.key.toLowerCase()&&e.shiftKey)?(e.preventDefault(),S.redo()):(e.ctrlKey||e.metaKey)&&"Enter"===e.key?(e.preventDefault(),S.parseTable()):(e.ctrlKey||e.metaKey)&&e.shiftKey&&"C"===e.key.toUpperCase()?(e.preventDefault(),S.copyOutputToClipboard()):"Escape"===e.key&&h.hide():(e.preventDefault(),S.undo())}))},initializeAccessibility:()=>{const e=document.createElement("div");e.setAttribute("aria-live","polite"),e.setAttribute("aria-atomic","true"),e.className="sr-only",e.id="status-live-region",document.body.appendChild(e);const t=E.render;E.render=function(){t.call(this),T.isEmpty()||(e.textContent=`Table updated: ${T.stats.rows} rows, ${T.stats.columns} columns`)},S.setupFocusManagement()},setupFocusManagement:()=>{document.addEventListener("keydown",(e=>{if("Tab"===e.key){const t=document.querySelectorAll('button:not([disabled]), [href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), [tabindex]:not([tabindex="-1"]):not([disabled]), details:not([disabled]), summary:not(:disabled)'),r=t[0],n=t[t.length-1];e.shiftKey&&document.activeElement===r?(e.preventDefault(),n.focus()):e.shiftKey||document.activeElement!==n||(e.preventDefault(),r.focus())}}))},initializeAutoSave:()=>{const e=i((()=>{if(!T.isEmpty()){const e={headers:T.headers,rows:T.rows,alignments:T.alignments,inputValue:o.input.value,timestamp:Date.now()};localStorage.setItem("md-table-editor-autosave",JSON.stringify(e))}}),2e3),t=localStorage.getItem("md-table-editor-autosave");if(t)try{const e=JSON.parse(t);(Date.now()-e.timestamp)/36e5<24&&e.headers&&e.rows&&(confirm("Restore your previous session?")?(T.headers=e.headers,T.rows=e.rows,T.alignments=e.alignments||[],o.input.value=e.inputValue||"",E.render(),R.generate(),h.success("Previous session restored")):localStorage.removeItem("md-table-editor-autosave"))}catch(e){localStorage.removeItem("md-table-editor-autosave")}const r=T.saveToHistory;T.saveToHistory=function(){r.call(this),e()}}};S.init()})();