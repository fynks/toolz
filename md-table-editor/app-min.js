(()=>{"use strict";const e=document.getElementById("themeToggle"),t=e.querySelector(".sun"),n=e.querySelector(".moon"),r=document.getElementById("input"),a=document.getElementById("output"),o=document.getElementById("tableContainer"),d=document.getElementById("analysisSection"),s=document.getElementById("analysisMarkdownOutput"),l=document.getElementById("parseBtn"),i=document.getElementById("analyzeBtn"),c=document.getElementById("copyBtn"),m=document.getElementById("clearBtn"),g=document.getElementById("addColumnBtn"),u=document.getElementById("addRowBtn"),p=document.getElementById("sortRowsBtn"),h=document.getElementById("removeColumnBtn"),E=document.getElementById("removeRowBtn"),y=document.getElementById("reorderBtn"),v=document.getElementById("notification");let f={headers:[],rows:[],alignments:[]},w=!1;e.addEventListener("click",(()=>{const e="dark"===document.documentElement.getAttribute("data-theme")?"light":"dark";document.documentElement.setAttribute("data-theme",e),localStorage.setItem("theme",e),t.style.display="dark"===e?"block":"none",n.style.display="dark"===e?"none":"block"})),window.addEventListener("DOMContentLoaded",(()=>{const e=localStorage.getItem("theme")||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");document.documentElement.setAttribute("data-theme",e),t.style.display="dark"===e?"block":"none",n.style.display="dark"===e?"none":"block"}));const L=(e,t="success")=>{v.textContent=e,v.style.backgroundColor="error"===t?"#dc3545":"#4CAF50",v.style.display="block",setTimeout((()=>{v.style.display="none"}),3e3)},C=e=>e.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"),b=()=>{const e=r.value.trim();if(!e)return void L("Please enter a markdown table","error");const t=e.split("\n");if(t.length<2)L("Invalid table format","error");else try{f.headers=t[0].split("|").filter((e=>e.trim())).map((e=>C(e.trim())));const e=t[1].split("|").filter((e=>e.trim()));f.alignments=e.map((e=>(e=e.trim()).startsWith(":")&&e.endsWith(":")?"center":e.endsWith(":")?"right":"left")),f.rows=t.slice(2).map((e=>e.split("|").filter((e=>e.trim())).map((e=>C(e.trim()))))),B(),L("Table parsed successfully!")}catch(e){L("Error parsing table","error")}},B=()=>{const e=document.createElement("table"),t=document.createElement("thead"),n=document.createElement("tr");f.headers.forEach(((e,t)=>{const r=document.createElement("th");r.textContent=e,r.draggable=w,r.dataset.index=t,r.classList.toggle("dragging-allowed",w),w?(r.addEventListener("dragstart",k),r.addEventListener("dragover",x),r.addEventListener("drop",T)):(r.removeEventListener("dragstart",k),r.removeEventListener("dragover",x),r.removeEventListener("drop",T)),r.contentEditable=!w,r.tabIndex=w?-1:0,r.addEventListener("blur",(()=>{w||(f.headers[t]=C(r.textContent),D())})),n.appendChild(r)})),t.appendChild(n),e.appendChild(t);const r=document.createElement("tbody");f.rows.forEach(((e,t)=>{const n=document.createElement("tr");n.draggable=w,n.dataset.index=t,n.classList.toggle("dragging-allowed",w),w?(n.addEventListener("dragstart",k),n.addEventListener("dragover",x),n.addEventListener("drop",T)):(n.removeEventListener("dragstart",k),n.removeEventListener("dragover",x),n.removeEventListener("drop",T)),e.forEach(((e,r)=>{const a=document.createElement("td");a.contentEditable=!w,a.tabIndex=w?-1:0,a.textContent=e,a.addEventListener("blur",(()=>{w||(f.rows[t][r]=C(a.textContent),D())})),n.appendChild(a)})),r.appendChild(n)})),e.appendChild(r),o.innerHTML="",o.appendChild(e),D()},I=()=>{if(0===f.rows.length||0===f.headers.length)return;const e=f.rows.length;let t=`| **Total** = \`${e}\` |`;for(let n=1;n<f.headers.length;n++){f.headers[n];t+=` \`${f.rows.reduce(((e,t)=>e+("yes"===t[n]?.toLowerCase()?1:0)),0)}/${e}\` |`}s.textContent=t,L("Table analyzed!")},k=e=>{e.target.classList.add("dragging"),e.dataTransfer.setData("text/plain",e.target.dataset.index),e.dataTransfer.setData("type",e.target.tagName.toLowerCase())},x=e=>{e.preventDefault();const t=e.dataTransfer.getData("type"),n="tr"===t?o.querySelector("tbody"):o.querySelector("thead tr"),r=e.clientY;if("tr"===t){const e=S(n,r),t=document.querySelector(".dragging");null==e?n.appendChild(t):n.insertBefore(t,e)}},T=e=>{e.preventDefault();const t=parseInt(e.dataTransfer.getData("text/plain")),n=parseInt(e.target.dataset.index),r=e.dataTransfer.getData("type");if(t!==n){if("th"===r)q(t,n);else if("tr"===r){const e=o.querySelector("tbody"),n=e.querySelector("tr.dragging");if(n){const r=Array.from(e.children).indexOf(n);A(t,r)}}B(),I()}e.target.classList.remove("dragging");const a=document.querySelector(".dragging");a&&a.classList.remove("dragging")},S=(e,t)=>[...e.querySelectorAll("tr:not(.dragging)")].reduce(((e,n)=>{const r=n.getBoundingClientRect(),a=t-r.top-r.height/2;return a<0&&a>e.offset?{offset:a,element:n}:e}),{offset:Number.NEGATIVE_INFINITY}).element,q=(e,t)=>{const n=n=>{const r=n[e];n.splice(e,1),n.splice(t,0,r)};n(f.headers),n(f.alignments),f.rows.forEach((e=>n(e)))},A=(e,t)=>{const n=f.rows[e];f.rows.splice(e,1),f.rows.splice(t,0,n)},D=()=>{const e={center:":---:",right:"---:",left:":---"},t=`| ${f.alignments.map((t=>e[t])).join(" | ")} |`,n=[`| ${f.headers.join(" | ")} |`,t,f.rows.map((e=>`| ${e.join(" | ")} |`)).join("\n")].join("\n");return a.value=n,n};l.addEventListener("click",(()=>{b()})),i.addEventListener("click",(()=>{I(),d.open=!0})),c.addEventListener("click",(async()=>{try{await navigator.clipboard.writeText(a.value),L("Copied to clipboard!")}catch(e){a.select(),document.execCommand("copy"),L("Copied to clipboard!")}})),m.addEventListener("click",(()=>{confirm("Are you sure you want to clear everything?")&&(r.value="",a.value="",o.innerHTML="",f={headers:[],rows:[],alignments:[]},s.textContent="",L("All cleared"))})),g.addEventListener("click",(()=>{w||(f.headers.push("New Column"),f.alignments.push("left"),f.rows.forEach((e=>e.push(""))),B(),L("Column added"))})),u.addEventListener("click",(()=>{if(w)return;const e=Array(f.headers.length).fill("");f.rows.push(e),B(),L("Row added")})),p.addEventListener("click",(()=>{w||(f.rows.length?(f.rows.sort(((e,t)=>(e[0]?.toLowerCase()||"").localeCompare(t[0]?.toLowerCase()||""))),B(),L("Rows sorted alphabetically")):L("No rows to sort","error"))})),h.addEventListener("click",(()=>{if(w)return;if(f.headers.length<=1)return void L("Cannot remove the last column","error");const e=f.headers.length-1;f.headers.splice(e,1),f.alignments.splice(e,1),f.rows.forEach((t=>t.splice(e,1))),B(),I(),L("Column removed")})),E.addEventListener("click",(()=>{w||(0!==f.rows.length?(f.rows.pop(),B(),I(),L("Row removed")):L("No rows to remove","error"))})),y.addEventListener("click",(()=>{w=!w,y.textContent=w?"Edit Table":"Re-order",B()})),r.addEventListener("input",((e,t)=>{let n;return(...r)=>{clearTimeout(n),n=setTimeout((()=>e.apply(this,r)),t)}})(b,300))})();