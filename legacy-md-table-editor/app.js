"use strict";let tableData={headers:[],rows:[],alignments:[]};function initializeApp(){loadSavedTables()}function setupEventListeners(){document.getElementById("input").addEventListener("input",debounce(parseTable,300)),document.querySelectorAll("button").forEach((e=>{e.addEventListener("click",handleButtonClick)}))}function handleButtonClick(e){const t=e.target.getAttribute("data-action"),a={parse:parseTable,save:saveCurrentTable,copy:copyToClipboard,clear:clearAll,addColumn:addColumn,addRow:addRow,removeColumn:removeColumn,removeRow:removeRow};a[t]&&a[t]()}function parseTable(){const e=document.getElementById("input").value;if(!e.trim())return void showNotification("Please enter a markdown table","error");const t=e.trim().split("\n");if(t.length<3)showNotification("Invalid table format","error");else try{tableData.headers=t[0].split("|").filter((e=>e.trim())).map((e=>sanitizeInput(e.trim())));const e=t[1].split("|").filter((e=>e.trim()));tableData.alignments=e.map((e=>(e=e.trim()).startsWith(":")&&e.endsWith(":")?"center":e.endsWith(":")?"right":"left")),tableData.rows=t.slice(2).map((e=>e.split("|").filter((e=>e.trim())).map((e=>sanitizeInput(e.trim()))))),renderTable(),showNotification("Table parsed successfully!")}catch(e){showNotification("Error parsing table","error")}}function renderTable(){const e=document.getElementById("tableContainer"),t=document.createElement("table"),a=document.createElement("thead"),n=document.createElement("tr");tableData.headers.forEach(((e,t)=>{const a=createHeaderCell(e,t);n.appendChild(a)})),a.appendChild(n),t.appendChild(a);const o=document.createElement("tbody");tableData.rows.forEach(((e,t)=>{const a=document.createElement("tr");e.forEach(((e,n)=>{const o=createDataCell(e,t,n);a.appendChild(o)})),o.appendChild(a)})),t.appendChild(o),e.innerHTML="",e.appendChild(t),generateMarkdown()}function createHeaderCell(e,t){const a=document.createElement("th");return a.contentEditable=!0,a.textContent=e,a.draggable=!0,a.dataset.index=t,a.addEventListener("dragstart",handleDragStart),a.addEventListener("dragover",handleDragOver),a.addEventListener("drop",handleDrop),a.addEventListener("blur",(()=>{tableData.headers[t]=sanitizeInput(a.textContent),generateMarkdown()})),a}function createDataCell(e,t,a){const n=document.createElement("td");return n.contentEditable=!0,n.textContent=e,n.addEventListener("blur",(()=>{tableData.rows[t][a]=sanitizeInput(n.textContent),generateMarkdown()})),n}function handleDragStart(e){e.target.classList.add("dragging"),e.dataTransfer.setData("text/plain",e.target.dataset.index)}function handleDragOver(e){e.preventDefault()}function handleDrop(e){e.preventDefault();const t=parseInt(e.dataTransfer.getData("text/plain")),a=parseInt(e.target.dataset.index);t!==a&&(reorderColumns(t,a),renderTable())}function reorderColumns(e,t){const a=a=>{const n=a[e];a.splice(e,1),a.splice(t,0,n)};a(tableData.headers),a(tableData.alignments),tableData.rows.forEach((e=>a(e)))}function addColumn(){tableData.headers.push("New Column"),tableData.alignments.push("left"),tableData.rows.forEach((e=>e.push(""))),renderTable(),showNotification("Column added")}function addRow(){const e=Array(tableData.headers.length).fill("");tableData.rows.push(e),renderTable(),showNotification("Row added")}function removeColumn(){tableData.headers.length<=1?showNotification("Cannot remove last column","error"):(tableData.headers.pop(),tableData.alignments.pop(),tableData.rows.forEach((e=>e.pop())),renderTable(),showNotification("Column removed"))}function removeRow(){tableData.rows.length<=1?showNotification("Cannot remove last row","error"):(tableData.rows.pop(),renderTable(),showNotification("Row removed"))}function generateMarkdown(){const e={center:":---:",right:"---:",left:":---"},t=[`| ${tableData.headers.join(" | ")} |`,`| ${tableData.alignments.map((t=>e[t])).join(" | ")} |`,...tableData.rows.map((e=>`| ${e.join(" | ")} |`))].join("\n");return document.getElementById("output").value=t,t}async function saveCurrentTable(){const e=generateMarkdown();if(!e)return void showNotification("No table to save","error");const t=await promptAsync("Enter a name for this table:");if(t)try{const a=getSavedTables();a[t]={markdown:e,date:(new Date).toISOString()},localStorage.setItem("savedTables",JSON.stringify(a)),showNotification("Table saved successfully!"),loadSavedTables()}catch(e){showNotification("Error saving table","error")}}function getSavedTables(){try{return JSON.parse(localStorage.getItem("savedTables"))||{}}catch{return{}}}function loadSavedTables(){const e=getSavedTables(),t=document.getElementById("saveList");t.innerHTML="",Object.entries(e).forEach((([e,a])=>{const n=createSavedTableItem(e,a);t.appendChild(n)}))}function createSavedTableItem(e,t){const a=document.createElement("div");a.className="saved-item";const n=document.createElement("span");n.textContent=e;const o=document.createElement("div");o.className="item-actions";const r=createButton("Load",(()=>loadTable(t.markdown)));r.className="load-btn";const l=createButton("Delete",(()=>deleteTable(e)));return l.className="delete-btn",o.appendChild(r),o.appendChild(l),a.appendChild(n),a.appendChild(o),a}function createButton(e,t){const a=document.createElement("button");return a.textContent=e,a.addEventListener("click",t),a}function loadTable(e){document.getElementById("input").value=e,parseTable(),showNotification("Table loaded successfully!")}function deleteTable(e){if(!confirm(`Are you sure you want to delete the table "${e}"?`))return;const t=getSavedTables();delete t[e],localStorage.setItem("savedTables",JSON.stringify(t)),loadSavedTables(),showNotification("Table deleted successfully!")}async function copyToClipboard(){try{const e=document.getElementById("output").value;await navigator.clipboard.writeText(e),showNotification("Copied to clipboard!")}catch{document.getElementById("output").select(),document.execCommand("copy"),showNotification("Copied to clipboard!")}}function clearAll(){confirm("Are you sure you want to clear everything?")&&(document.getElementById("input").value="",document.getElementById("output").value="",document.getElementById("tableContainer").innerHTML="",tableData={headers:[],rows:[],alignments:[]},showNotification("All cleared"))}function showNotification(e,t="success"){const a=document.getElementById("notification");a.textContent=e,a.style.backgroundColor="error"===t?"#dc3545":"#4CAF50",a.style.display="block",setTimeout((()=>{a.style.display="none"}),3e3)}function sanitizeInput(e){return e.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function debounce(e,t){let a;return function(...n){clearTimeout(a),a=setTimeout((()=>{clearTimeout(a),e(...n)}),t)}}async function promptAsync(e){return new Promise((t=>{t(prompt(e))}))}document.addEventListener("DOMContentLoaded",(()=>{initializeApp(),setupEventListeners()}));