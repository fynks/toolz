<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="mobile-web-app-capable" content="yes">
    <link rel="icon" href="../favicon.ico" sizes="any">
    <link rel="icon" href="../favicon.svg" type="image/svg+xml">
    <title>Subreddit Subscription Converter</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
 *, *::before, *::after{ box-sizing: border-box;} body, h1, h2, h3, h4, h5, h6, p, ol, ul, li, figure, figcaption, blockquote, dl, dd{ margin: 0; padding: 0;} ol, ul{ list-style: none;} body{ font-family: 'Roboto', sans-serif; line-height: 1.6; min-height: 100vh; background-color: #f8f9fa; color: #343a40; display: flex; flex-direction: column; align-items: center; padding: 30px;} main{ width: 100%; max-width: 960px; margin: 20px 0; padding: 0 20px; position: relative; } .container{ background-color: #ffffff; border-radius: 16px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08); padding: 40px; margin-top: 20px;} header{ text-align: center; margin-bottom: 25px; } h2{ font-size: 2.2rem; font-weight: 700; color: #212529; margin-bottom: 8px; } textarea, input[type="text"]{ width: 100%; padding: 16px; margin-bottom: 24px; border: 2px solid #eaecef; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.04); border-radius: 12px; font-size: 1rem; color: #495057;} textarea:focus, input[type="text"]:focus{ outline: none; border-color: #5498e6; box-shadow: 0 0 0 3px rgba(3, 102, 214, 0.15);} textarea{ min-height: 120px; resize: vertical; } .controls{ margin-block: 0.5rem; display: flexbox;} button{ border-radius: 12px; background-color: #007bff; color: #fff; border: 1px solid #007bff; padding: 10px 20px; font-size: 0.9rem; font-weight: 500; cursor: pointer; transition: all 0.2s ease; margin-right: 8px; margin-bottom: 8px; margin-top: 8px;} button:hover{ background-color: #0056b3; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); } button:active{ box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05); } button:focus{ outline: none; box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.5);} button:last-child{ margin-right: 0;} #toast-container{ position: fixed; top: 30px; right: 30px; z-index: 1000; display: flex; flex-direction: column; align-items: flex-end; pointer-events: none; } .toast{ background-color: #ffffff; opacity: 0; transform: translateY(-20px); transition: opacity 0.3s ease-out, transform 0.3s ease-out; pointer-events: auto; min-width: 250px; word-wrap: break-word; padding: 16px 24px; border-radius: 12px; box-shadow: 0 8px 16px rgba(0, 0, 0, 0.12); margin-bottom: 12px;} .toast.show{ opacity: 1; transform: translateY(0);} .toast.error-toast{ background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb;} .toast.success-toast{ background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb;} .checkbox-container{ display: flex; align-items: center; margin-bottom: 12px; } .checkbox-container input[type="checkbox"]{ width: 20px; height: 20px; margin-right: 12px; appearance: none; background-color: #fff; border: 1px solid #ced4da; border-radius: 4px; cursor: pointer; position: relative; transition: background-color 0.2s ease-in-out, border-color 0.2s ease-in-out;} .checkbox-container input[type="checkbox"]:checked{ background-color: #007bff; border-color: #007bff;} .checkbox-container input[type="checkbox"]:checked::before{ content: '\2713'; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: white; font-size: 14px;} .checkbox-container label{ font-size: 1rem; color: #495057; cursor: pointer;} .instructions{ margin-bottom: 20px; padding: 20px; background-color: #f8f9fa; border-radius: 8px; border: 1px solid #ced4da;} .instructions p, .instructions ol{ margin-bottom: 10px; font-size: 0.9rem; color: #6c757d;} .instructions ol li{ margin-bottom: 5px;} .instructions a{ color: #007bff; text-decoration: none; font-weight: 500;} .instructions a:hover{ text-decoration: underline;} .search-container{ background-color: #f8f9fa; border-radius: 8px; padding: 16px; margin: 24px 0; display: grid; grid-template-columns: auto 1fr auto; gap: 12px; align-items: center;} .search-container input[type="text"]{ margin-bottom: 0; height: 38px; border: 1px solid #e1e4e8;} .search-container p{ margin-right: 10px; font-size: 1rem; color: #495057;} .output-container{ margin-top: 32px;} .output-container p{ font-size: 0.9rem; color: #57606a; margin-bottom: 8px; font-weight: 500;} #subscriptionOutput{ background-color: #f8f9fa; border: 1px solid #e1e4e8; padding: 16px; font-family: 'Monaco', 'Consolas', monospace; font-size: 0.9rem; color: #2d333b; min-height: 100px;} @media (max-width: 768px){ body{ padding: 20px;} main{ padding: 0 10px;} .container{ padding: 30px 20px; margin-top: 10px;} h2{ font-size: 2rem;} button{ font-size: 0.9rem; padding: 10px 25px; border-radius: 1rem;} .search-container{ grid-template-columns: 1fr;} .search-container button{ margin-left: 0; margin-right: 0;} #toast-container{ top: 20px; right: 20px; left: 20px;} .toast{ margin-bottom: 8px;} .controls{ display: grid; grid-template-columns: 1fr; gap: 8px;}}
    </style>
</head>

<body>
    <main>
        <div class="container">
            <header>
                <h2>Subreddit to Subscription Converter</h2>
            </header>
            <div class="input-container">
                <textarea id="subredditInput" placeholder="Enter subreddits here (one per line)" autofocus></textarea>
            </div>
            <div class="controls">
                <button type="button" onclick="clearInput()">Clear</button>
                <button type="button" onclick="showSelectiveCheckboxes()">Selection</button>
                <button type="button" onclick="showFetchInstructions()">Fetch Subreddits</button>
                <button type="button" onclick="convertToSubscriptions()">Convert to Subscriptions</button>
                <button type="button" onclick="copyToClipboard()">Copy to Clipboard</button>
                <button type="button" id="subscriptionButton" style="display: none;"
                    onclick="openSubscriptionConfig()">View Config</button>
            </div>
            <div id="fetchInstructions" class="instructions" style="display: none;">
                <p>To fetch your subreddits from old.reddit.com, follow these steps:</p>
                <ol>
                    <li>Visit <a href="https://old.reddit.com/subreddits/mine"
                            target="_blank">old.reddit.com/subreddits/mine</a> and make sure you're logged in.</li>
                    <li>Open your browser developer tools (Keybind: Ctrl+Shift+I).</li>
                    <li>Go to the Console tab and copy-paste the following code snippet, then press Enter:</li>
                    <textarea readonly
                        style="width: 100%; height: 100px;">const subreddits=Array.from($('.subscription-box li a.title')).map(link=>link.textContent).join('\n'); const textarea=document.createElement('textarea'); textarea.value=subreddits; document.body.replaceWith(textarea);</textarea>
                    <li>Copy the list of subreddits that appear on the webpage and paste them into the textarea above.
                    </li>
                </ol>
            </div>
            <div class="search-container">
                <p>Search Subreddits:</p>
                <input type="text" id="searchInput" oninput="filterSubreddits()" placeholder="Search subreddits...">
                <button type="button" onclick="selectAllMatching()">Select <span id="selectedCount">all</span>
                    Matching</button>
            </div>

            <div id="checkboxesContainer"></div>
            <div class="output-container">
                <p>Converted Subscriptions:</p>
                <textarea id="subscriptionOutput" readonly placeholder="Subscription URL will appear here"></textarea>
            </div>
        </div>
        <div id="toast-container"></div>
    </main>
    <script>
        const debounce = (func, wait) => {
            let timeout;
            return (...args) => {
                clearTimeout(timeout);
                timeout = setTimeout(() => func.apply(this, args), wait);
            };
        };

        const clearInput = () => {
            if (confirm('Are you sure you want to clear both fields?')) {
                document.getElementById('subredditInput').value = '';
                document.getElementById('subscriptionOutput').value = '';
            }
        };

        const showSelectiveCheckboxes = () => {
            const inputTextArea = document.getElementById('subredditInput');
            const subredditList = inputTextArea.value.trim().split('\n').filter(Boolean);
            const checkboxesContainer = document.getElementById('checkboxesContainer');
            checkboxesContainer.innerHTML = '';

            subredditList.forEach(subreddit => {
                if (subreddit.trim().startsWith('u/')) return;
                const subredditEntry = document.createElement('div');
                subredditEntry.classList.add('checkbox-container');

                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.name = 'subredditCheckbox';
                checkbox.value = subreddit.trim();
                subredditEntry.appendChild(checkbox);

                const label = document.createElement('label');
                label.textContent = subreddit.trim();
                subredditEntry.appendChild(label);

                checkboxesContainer.appendChild(subredditEntry);
            });
            filterSubreddits();
        };

        const filterSubreddits = debounce(() => {
            const input = document.getElementById('searchInput');
            const filter = input.value.trim().toLowerCase();
            const labels = document.querySelectorAll('.checkbox-container label');
            const [includeTerms, excludeTerms] = filter.split('-').map(term => term.split('+'));

            labels.forEach(label => {
                const txtValue = label.textContent.toLowerCase();
                const entry = label.parentElement;
                const includeMatch = includeTerms.every(term => txtValue.includes(term.trim()));
                const excludeMatch = excludeTerms && excludeTerms.some(term => txtValue.includes(term.trim()));
                entry.style.display = includeMatch && !excludeMatch ? '' : 'none';
            });
            updateSelectedCount();
        }, 300);

        const selectAllMatching = () => {
            const visibleEntries = document.querySelectorAll('.checkbox-container:not([style="display: none;"])');
            const checkedCheckboxes = document.querySelectorAll('input[name=subredditCheckbox]:checked');
            const shouldCheck = !checkedCheckboxes.length;

            visibleEntries.forEach(entry => {
                const checkbox = entry.querySelector('input[name=subredditCheckbox]');
                checkbox.checked = shouldCheck;
            });
            updateSelectedCount();
        };

        const updateSelectedCount = () => {
            const selectedCountSpan = document.getElementById('selectedCount');
            const checkboxes = document.querySelectorAll('input[name=subredditCheckbox]:checked');
            selectedCountSpan.textContent = checkboxes.length;
        };

        const displayMessage = (messageText, isError = false, autoHideDelay = 3000) => {
            const toastContainer = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.classList.add('toast');
            toast.textContent = messageText;

            if (isError) {
                toast.classList.add('error-toast');
            } else {
                toast.classList.add('success-toast');
            }

            toastContainer.appendChild(toast);
            // Force reflow to trigger transition
            requestAnimationFrame(() => toast.classList.add('show'));


            if (autoHideDelay) {
                setTimeout(() => {
                    toast.classList.remove('show');
                    toast.addEventListener('transitionend', () => {
                        toast.remove();
                    }, { once: true }); // Remove after transition
                }, autoHideDelay);
            }
        };


        const convertToSubscriptions = () => {
            const checkboxes = document.querySelectorAll('input[name=subredditCheckbox]:checked');
            const outputTextArea = document.getElementById('subscriptionOutput');
            const subscriptionButton = document.getElementById('subscriptionButton');

            if (!checkboxes.length) {
                displayMessage('Please select at least one subreddit.', true);
                outputTextArea.value = '';
                subscriptionButton.style.display = 'none';
                return;
            }


            const selectedSubreddits = Array.from(checkboxes)
                .map(checkbox => checkbox.value)
                .filter(subreddit => !subreddit.startsWith('u/'));
            const subscriptions = selectedSubreddits
                .map(subreddit => encodeURIComponent(subreddit.trim()))
                .join('%2B');

            const config = {
                theme: 'dark',
                front_page: 'default',
                layout: 'card',
                wide: 'off',
                post_sort: 'hot',
                comment_sort: 'confidence',
                show_nsfw: 'on',
                use_hls: 'off',
                hide_hls_notification: 'on',
                hide_awards: 'on',
                fixed_navbar: 'off',
                subscriptions,
                filters: ''
            };

            const subscriptionURL = `https://farside.link/redlib/settings/restore/?${new URLSearchParams(config).toString()}`;
            outputTextArea.value = subscriptionURL;

            if (outputTextArea.value.startsWith('https://farside.link/redlib')) {
                displayMessage('Conversion successful!', false);
                subscriptionButton.style.display = 'inline-block';
                checkboxes.forEach(checkbox => {
                    const entry = checkbox.parentElement;
                    entry.style.display = 'none';
                });
            } else {
                displayMessage('Error: Unable to convert. Please try again.', true);
                subscriptionButton.style.display = 'none';
            }
        };

        const copyToClipboard = async () => {
            try {
                await navigator.clipboard.writeText(document.getElementById('subscriptionOutput').value);
                displayMessage('Subscription URL copied to clipboard!', false);
            } catch (err) {
                console.error('Failed to copy:', err);
                displayMessage('Failed to copy to clipboard.', true);
            }
        };

        const openSubscriptionConfig = () => {
            window.open(document.getElementById('subscriptionOutput').value, '_blank');
        };

        const showFetchInstructions = () => {
            const fetchInstructions = document.getElementById('fetchInstructions');
            fetchInstructions.style.display = fetchInstructions.style.display === 'none' ? 'block' : 'none';
        };
    </script>
</body>

</html>