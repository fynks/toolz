const MAX_INPUT_LENGTH=1e4,MAX_HISTORY=10,SHORTCUTS={ENCODE:{key:"Enter",ctrl:!0},DECODE:{key:"b",ctrl:!0},COPY:{key:"c",ctrl:!0,shift:!0},CLEAR:{key:"k",ctrl:!0}},inputText=document.getElementById("inputText"),output=document.getElementById("output"),copyBtn=document.getElementById("copyBtn"),toast=document.getElementById("toast");let history=[],historyIndex=-1,isProcessing=!1;const isValidInput=e=>e&&e.trim().length>0&&e.length<1e4,isValidBase64URL=e=>/^[-A-Za-z0-9_]*$/.test(e),addToHistory=e=>{history.includes(e)||(history.unshift(e),history.length>10&&history.pop()),historyIndex=-1},showToast=(e="Copied to clipboard!")=>{toast.textContent=e,toast.classList.add("show"),setTimeout((()=>toast.classList.remove("show")),2e3)},setLoading=e=>{isProcessing=e,document.querySelectorAll("button").forEach((t=>t.disabled=e)),output.closest(".result-wrapper").classList.toggle("loading",e)},showOutput=(e,t="encoded")=>{output.innerHTML=`<p class="${t}">${e}</p>`,copyBtn.style.display="error"===t?"none":"flex",output.closest(".result-wrapper").classList.toggle("loading",!1)},encodeBase64URL=async()=>{const e=inputText.value.trim();if(isValidInput(e))try{setLoading(!0);const t=btoa(unescape(encodeURIComponent(e))).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"");addToHistory(e),showOutput(`Encoded: ${t}`)}catch(e){showOutput(`Encoding failed: ${e.message}`,!0)}finally{setLoading(!1)}else showOutput("Please enter valid text (1-10000 characters).",!0)},decodeBase64URL=async()=>{const e=inputText.value.trim();if(isValidInput(e))if(/^[-A-Za-z0-9_]*$/.test(e))try{setLoading(!0);const t=e.replace(/-/g,"+").replace(/_/g,"/").padEnd(e.length+(4-e.length%4)%4,"="),o=decodeURIComponent(escape(atob(t)));addToHistory(e),showOutput(`Decoded: ${o}`)}catch(e){showOutput(`Decoding failed: ${e.message}`,!0)}finally{setLoading(!1)}else showOutput("Invalid Base64URL format. Use only A-Z, a-z, 0-9, -, and _",!0);else showOutput("Please enter valid Base64URL text.",!0)},copyOutput=async()=>{if(!isProcessing)try{setLoading(!0);const e=output.textContent.replace("Encoded: ","").replace("Decoded: ","");await navigator.clipboard.writeText(e),showToast()}catch(e){showToast("Failed to copy text")}finally{setLoading(!1)}},clearAll=()=>{isProcessing||(inputText.value="",output.innerHTML="",copyBtn.style.display="none",inputText.focus())};document.addEventListener("keydown",(e=>{isProcessing||((e.ctrlKey||e.metaKey)&&(e.key===SHORTCUTS.ENCODE.key?(e.preventDefault(),encodeBase64URL()):e.key===SHORTCUTS.DECODE.key?(e.preventDefault(),decodeBase64URL()):e.key===SHORTCUTS.CLEAR.key?(e.preventDefault(),isProcessing||(inputText.value="",output.innerHTML="",copyBtn.style.display="none",inputText.focus())):e.shiftKey&&e.key===SHORTCUTS.COPY.key&&"none"!==copyBtn.style.display&&(e.preventDefault(),copyOutput())),document.activeElement===inputText&&("ArrowUp"===e.key&&history.length>0?(e.preventDefault(),historyIndex=Math.min(historyIndex+1,history.length-1),inputText.value=history[historyIndex]):"ArrowDown"===e.key&&historyIndex>-1&&(e.preventDefault(),historyIndex=Math.max(-1,historyIndex-1),inputText.value=-1===historyIndex?"":history[historyIndex])))})),inputText.focus();